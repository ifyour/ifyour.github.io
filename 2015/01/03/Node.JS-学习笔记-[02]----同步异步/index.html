<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ifyour's Blog"><meta name="msapplication-TileImage" content="/img/webAppIcon-256x256.png"><meta name="msapplication-TileColor" content="#000"><meta property="algolia:search" data-application-id="3XQ5CPDDMK" data-api-key="abe9e26eebcac723f34ade5cf6b97441" data-index-name="prod_blog"><title>Node.JS å­¦ä¹ ç¬”è®° [02] -- åŒæ­¥å¼‚æ­¥ Â· Ifyour's Blog</title><meta name="description" content="Node.JS å­¦ä¹ ç¬”è®° [02] -- åŒæ­¥å¼‚æ­¥ - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="apple-touch-icon" size="256x256" href="/img/webAppIcon-256x256.png"><link rel="apple-touch-icon" size="512x512" href="/img/webAppIcon-512x512.png"><link rel="apple-touch-startup-image" href="/img/apple-launch-750x1334.png"><link rel="preload" href="/css/apollo.css" as="style"><link rel="preload" href="/js/main.js" as="script"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="search"><a href="javascript:;" target="_self" class="close"><svg id="icon-close" viewbox="0 0 16 16" width="24" height="24" fill="#A4A9AC"><path d="M8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 Z M10.44352,10.7233105 L10.4528296,10.7326201 L10.7326201,10.4528296 C11.0310632,10.1543865 11.0314986,9.66985171 10.7335912,9.37194437 L9.36507937,8.0034325 L10.7360526,6.63245928 C11.0344957,6.33401613 11.0349311,5.84948135 10.7370237,5.55157401 L10.448426,5.26297627 C10.1505186,4.96506892 9.66598387,4.96550426 9.36754072,5.26394741 L8.00589385,6.62559428 L6.63738198,5.25708241 C6.33947464,4.95917507 5.85493986,4.95961041 5.55649671,5.25805356 L5.26737991,5.54717036 C4.96893676,5.84561351 4.96850142,6.33014829 5.26640876,6.62805563 L6.62561103,7.9872579 L5.25463781,9.35823112 C4.95619466,9.65667427 4.95575932,10.141209 5.25366666,10.4391164 L5.5422644,10.7277141 C5.84017175,11.0256215 6.32470652,11.0251861 6.62314967,10.726743 L7.99412289,9.35576976 L9.36263476,10.7242816 C9.66054211,11.022189 10.1450769,11.0217536 10.44352,10.7233105 Z"/></svg></a><div class="container"><input id="search-input" autocomplete="off" type="text" placeholder="Type to search" class="search-input"><div class="search-by">Search by<a href="https://www.algolia.com/" target="_blank"> algolia</a></div><div class="search-results"><div id="search-articles" class="search-item"></div></div></div><script id="search-tmp" type="text/html">{{if list.length}}
    <h3>ARTICLES</h3>
    <ul>
        {{each list item}}
        <li>
            <div class="search-item-title">
                <a href="{{item.permalink}}">{{@item.title}}</a>
            </div>
            <div class="search-item-summary" style="-webkit-box-orient: vertical;">
                {{@item.summary}}
            </div>
        </li>
        {{/each}}
    </ul>
{{else if list}}
    <h2>
        Oops! no result,
        Try it on <a target="_blank" style="color: #2c3e50; border-bottom: 2px solid #42b983; font-size: 19px;" href="https://www.google.com/search?q=site%3Aifyour.github.io+{{keywords}}">Google: {{keywords}}</a>~ ğŸ˜±
    </h2>
{{/if}}</script></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/docs/" target="_self" class="nav-list-link">DOCS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="javascript:;" target="_self" id="search" class="nav-list-link">SEARCH</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node.JS å­¦ä¹ ç¬”è®° [02] -- åŒæ­¥å¼‚æ­¥</h1><div class="post-info">Jan 3, 2015</div><div class="sidebar-toc"><span>Catalog</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-ä½¿ç”¨"><span class="toc-text">Node.js ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js-æ§åˆ¶å°"><span class="toc-text">Node.js æ§åˆ¶å°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js-ä½œç”¨åŸŸ"><span class="toc-text">Node.js ä½œç”¨åŸŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å›è°ƒå‡½æ•°"><span class="toc-text">å›è°ƒå‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-äº‹ä»¶"><span class="toc-text">Node.js äº‹ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#äº‹ä»¶å¸¸ç”¨æ–¹æ³•"><span class="toc-text">äº‹ä»¶å¸¸ç”¨æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-å¼‚æ­¥ä¸åŒæ­¥"><span class="toc-text">Node.js å¼‚æ­¥ä¸åŒæ­¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å¼‚æ­¥çš„å®ç°"><span class="toc-text">å¼‚æ­¥çš„å®ç°</span></a></li></ol></li></ol></div><div class="post-content"><p>åœ¨ä½¿ç”¨ npm çš„æ—¶å€™ï¼Œæˆ‘å‘ç°åœ¨é€Ÿåº¦å®åœ¨å¤ªæ…¢ï¼Œå®‰è£…å°ä¸€ç‚¹çš„åŒ…ç¡®å®æ²¡å•¥é—®é¢˜ï¼Œè£…å¤§ä¸€ç‚¹çš„ï¼Œä¾èµ–å¤šä¸€ç‚¹çš„åŒ…çš„æ—¶å€™ï¼Œé—®é¢˜å°±æ¥äº†ã€‚é€Ÿåº¦æ…¢ï¼Œå“åº”è¿Ÿé’ã€‚<strong><em>nrm</em></strong> æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå®‰è£… nrm åï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„å‘½ä»¤å¿«é€Ÿæ¥åˆ‡æ¢ npm æºï¼Œæ¯”å¦‚åˆ‡æ¢åˆ° cnpmã€taobao æºç­‰ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥ç‚¹<a href="https://github.com/Pana/nrm#install" target="_blank" rel="noopener">è¿™é‡Œ</a>è¿›å»äº†è§£ä¸‹ã€‚<br><a id="more"></a></p>
<h3 id="Node-js-ä½¿ç”¨"><a href="#Node-js-ä½¿ç”¨" class="headerlink" title="Node.js ä½¿ç”¨"></a>Node.js ä½¿ç”¨</h3><h4 id="Node-js-æ§åˆ¶å°"><a href="#Node-js-æ§åˆ¶å°" class="headerlink" title="Node.js æ§åˆ¶å°"></a>Node.js æ§åˆ¶å°</h4><p>å‰é¢è¯´äº†ï¼ŒNode.js æä¾›äº† REPL æ¨¡å¼æ¥è§£æè¾“å…¥çš„æ¯æ¡å‘½ä»¤ï¼Œç°åœ¨å¯ä»¥å®æˆ˜ä¸€ä¸‹äº†ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œç„¶åè¾“å…¥ <code>node</code> è¿›å…¥ Node.js å¼€å§‹æ•²å‘½ä»¤å§ï¼<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello,world!'</span>); <span class="comment">// æ™®é€šè¾“å…¥</span></span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">'é”™è¯¯æ¶ˆæ¯'</span>);    <span class="comment">// é”™è¯¯è¾“å‡º</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'time'</span>);        <span class="comment">// ä¼šè®¡ç®—åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¹‹é—´çš„ä»£ç å—æ‰§è¡Œè€—æ—¶</span></span><br><span class="line"><span class="comment">// &#123;...&#125;</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'time'</span>);</span><br><span class="line"><span class="built_in">console</span>.assert(<span class="number">3</span>&gt;<span class="number">10</span>,<span class="string">'str..'</span>);<span class="comment">// æ–­è¨€ï¼šè¡¨è¾¾å¼ä¸æˆç«‹ï¼Œä¼šè¾“å‡ºåé¢çš„å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Node-js-ä½œç”¨åŸŸ"><a href="#Node-js-ä½œç”¨åŸŸ" class="headerlink" title="Node.js ä½œç”¨åŸŸ"></a>Node.js ä½œç”¨åŸŸ</h4><ul>
<li>å…¨å±€ä½œç”¨åŸŸï¼šæ²¡æœ‰ä½¿ç”¨ <code>var</code> éšå¼å£°æ˜çš„ä¸€ä¸ªå˜é‡ï¼Œä¼šäº«å—å…¨å±€ä½œç”¨åŸŸï¼Œæˆ–è€…åœ¨ <code>global</code> ä¸ŠæŒ‚è½½çš„å˜é‡ï¼Œä¹Ÿå…·æœ‰å…¨å±€ä½œç”¨åŸŸçš„å±æ€§ï¼Œå…¨å±€å˜é‡å¯ä»¥è¢«å…¶å®ƒæ¨¡å—ä½¿ç”¨ã€‚</li>
<li>å±€éƒ¨ä½œç”¨åŸŸï¼šåœ¨ Node.js ä¸­ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œåœ¨è¿™ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„å˜é‡ï¼Œåªèƒ½åœ¨è¿™ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™äº›å˜é‡éƒ½å±äºå…¨å±€å˜é‡</span></span><br><span class="line">name = <span class="string">'ifyour'</span>;</span><br><span class="line">global.age = <span class="number">18</span>; <span class="comment">// Node.js ä¸­çš„ global ç±»ä¼¼ JavaScript ä¸­çš„ window</span></span><br></pre></td></tr></table></figure>
<div class="tip"><br>å°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡ï¼Œä¼šé€ æˆå˜é‡æ±¡æŸ“ã€‚<br></div>

<h4 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h4><p>Node.js ä¸­å¤§é‡ä½¿ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå…³äºå›è°ƒå‡½æ•°ï¼Œæˆ‘ä¹‹å‰åœ¨ç®€ä¹¦å†™äº†ä¸€ç¯‡ï¼Œæˆ‘çš„ç†è§£å¿ƒå¾—ï¼Œæœ‰å…´è¶£çš„å¯ä»¥<a href="http://www.jianshu.com/p/1383f4cb9a75" target="_blank" rel="noopener">å»çœ‹çœ‹</a>ã€‚å…³äºå›è°ƒå‡½æ•°ï¼Œæˆ‘ä¹Ÿæ­£æ˜¯åœ¨ Node.js ä¸­å¯¹å®ƒçš„ç†è§£æ›´ä¸ºæ·±åˆ»äº†ï¼ŒNode.js å¤§é‡çš„å¼‚æ­¥ä»£ç éƒ½å€ŸåŠ©å›è°ƒå‡½æ•°å®ç°ï¼Œæ­£å› å¦‚æ­¤ï¼Œæ€§èƒ½æ›´é«˜å‘€ã€‚çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello,callback!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå›è°ƒå‡½æ•°çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ä¼ å…¥è¯¥å‡½æ•°ï¼Œä¸€ç§’åæ‰§è¡Œ</span></span><br><span class="line">setTimeout(cb,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>å€ŸåŠ©è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°å›è°ƒå‡½æ•°çš„å®ç°æœºåˆ¶ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼ˆå…¶å®å®ƒå°±æ˜¯å›è°ƒå‡½æ•°ï¼‰</li>
<li>å°†è¯¥å‡½æ•°çš„å¼•ç”¨åœ°å€ä½œä¸ºå‚æ•°ä¼ ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å­ä¸­çš„ <code>setTimeout</code></li>
<li>å½“ç‰¹å®šæ¡ä»¶å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨è€…ä½¿ç”¨è¿™ä¸ªå¼•ç”¨åœ°å€å»æ‰§è¡Œè¯¥å‡½æ•°</li>
</ul>
<p>å›è°ƒå‡½æ•°çš„ç”¨é€”å¾ˆå¤šï¼Œæ¯”å¦‚å®ç°äº‹ä»¶æ³¨å†Œã€å¼‚æ­¥ä»£ç ç­‰ã€‚åœ¨ jQuery ä¸­çš„åŠ¨ç”»å°±æ˜¯å›è°ƒå‡½æ•°çš„ç»å…¸ç”¨æ³•ï¼Œ<code>animate(x,y,z,function(){...})</code>,å½“ä¸€ä¸ªåŠ¨ç”»æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å½“ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„å‡½æ•°å—ï¼Œè¿™äº›éƒ½æ˜¯å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="Node-js-äº‹ä»¶"><a href="#Node-js-äº‹ä»¶" class="headerlink" title="Node.js äº‹ä»¶"></a>Node.js äº‹ä»¶</h3><p>Node.js ä¸­çš„ event æ¨¡å—å°±æ˜¯æä¾›äº‹ä»¶ç¼–ç¨‹çš„ APIï¼Œæ‰€æœ‰å…·æœ‰è§¦å‘äº‹ä»¶çš„å¯¹è±¡éƒ½ç»§æ‰¿æˆ–å†…éƒ¨åŒ…å«äº† <code>EventEmitter</code> å¯¹è±¡ã€‚æ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­å§ï¼<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//events æ¨¡å—ä¸­çš„ EventEmitter å¯¹è±¡ï¼Œå®šä¹‰äº†äº‹ä»¶å¯¹è±¡çš„åŸºç¡€ä¿¡æ¯å’Œè¡Œä¸º</span></span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> EventEmitter();<span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª event å¯¹è±¡</span></span><br><span class="line">event.on(<span class="string">'myevent'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123; <span class="comment">// ç»‘å®š myevent äº‹ä»¶</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hi!'</span> + name);</span><br><span class="line">&#125;);</span><br><span class="line">event.emit(<span class="string">'myevent'</span>,<span class="string">'ifyour'</span>);<span class="comment">// è§¦å‘äº‹ä»¶</span></span><br></pre></td></tr></table></figure></p>
<h4 id="äº‹ä»¶å¸¸ç”¨æ–¹æ³•"><a href="#äº‹ä»¶å¸¸ç”¨æ–¹æ³•" class="headerlink" title="äº‹ä»¶å¸¸ç”¨æ–¹æ³•"></a>äº‹ä»¶å¸¸ç”¨æ–¹æ³•</h4><table>
<thead>
<tr>
<th style="text-align:left">æ–¹æ³•</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">addListener(event, listener)</td>
<td style="text-align:left">ä¸ºæŒ‡å®šäº‹ä»¶æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨åˆ°ç›‘å¬å™¨æ•°ç»„çš„å°¾éƒ¨ã€‚ä¸ on ç­‰ä»·</td>
</tr>
<tr>
<td style="text-align:left">on(event, listener)</td>
<td style="text-align:left">ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸² event å’Œä¸€ä¸ªå›è°ƒå‡½æ•°</td>
</tr>
<tr>
<td style="text-align:left">once(event, listener)</td>
<td style="text-align:left">ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªå•æ¬¡ç›‘å¬å™¨</td>
</tr>
<tr>
<td style="text-align:left">removeListener(event,listener)</td>
<td style="text-align:left">ç§»é™¤æŒ‡å®šäº‹ä»¶çš„æŸä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å™¨å¿…é¡»æ˜¯è¯¥äº‹ä»¶å·²ç»æ³¨å†Œè¿‡çš„ç›‘å¬å™¨</td>
</tr>
<tr>
<td style="text-align:left">removeAllListeners([event])</td>
<td style="text-align:left">ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨å¦‚æœæŒ‡å®šäº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨</td>
</tr>
<tr>
<td style="text-align:left">setMaxListeners(n)</td>
<td style="text-align:left">setMaxListeners å‡½æ•°ç”¨äºæé«˜ç›‘å¬å™¨çš„é»˜è®¤é™åˆ¶çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ 10</td>
</tr>
<tr>
<td style="text-align:left">listeners(event)</td>
<td style="text-align:left">è¿”å›æŒ‡å®šäº‹ä»¶çš„ç›‘å¬å™¨æ•°ç»„</td>
</tr>
<tr>
<td style="text-align:left">emit(event, [arg1], [arg2], [â€¦])</td>
<td style="text-align:left">æŒ‰é¡ºåºæ‰§è¡Œç›‘å¬å™¨ï¼Œå¦‚æœäº‹ä»¶æœ‰æ³¨å†Œç›‘å¬è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td>
</tr>
</tbody>
</table>
<h3 id="Node-js-å¼‚æ­¥ä¸åŒæ­¥"><a href="#Node-js-å¼‚æ­¥ä¸åŒæ­¥" class="headerlink" title="Node.js å¼‚æ­¥ä¸åŒæ­¥"></a>Node.js å¼‚æ­¥ä¸åŒæ­¥</h3><p><strong><em>åŒæ­¥</em></strong>ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œæ€»æ—¶é—´ç­‰äºæ‰€æœ‰ä»»åŠ¡æ¶ˆè€—æ—¶é—´ä¹‹å’Œã€‚<br><strong><em>å¼‚æ­¥</em></strong>ï¼šå‡ ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œä¸é™åˆ¶å…ˆåï¼Œæ‰§è¡Œæ€»æ—¶é—´ç­‰äºæ‰§è¡Œè€—æ—¶æœ€é•¿çš„é‚£ä¸ªä»»åŠ¡çš„æ¶ˆè€—æ—¶é—´ã€‚</p>
<p>åœ¨ Node.js ä¸­æ¯ä¸€ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸåï¼Œä¸æ˜¯æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ï¼Œè€Œæ˜¯æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œåä¸€ä¸ªä»»åŠ¡åˆ™æ˜¯ä¸ç­‰å‰ä¸€ä¸ªä»»åŠ¡ç»“æŸå°±æ‰§è¡Œï¼Œæ‰€ä»¥ç¨‹åºçš„æ‰§è¡Œé¡ºåºä¸ä»»åŠ¡çš„æ’åˆ—é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€å¼‚æ­¥çš„ã€‚</p>
<h4 id="å¼‚æ­¥çš„å®ç°"><a href="#å¼‚æ­¥çš„å®ç°" class="headerlink" title="å¼‚æ­¥çš„å®ç°"></a>å¼‚æ­¥çš„å®ç°</h4><ul>
<li>å›è°ƒå‡½æ•°</li>
<li>äº‹ä»¶ï¼ˆåŸºäºå›è°ƒå‡½æ•°ï¼‰</li>
<li>Promise ï¼ˆES6ï¼‰</li>
</ul>
<p>å‰é¢å·²ç»è®²äº†å›è°ƒå‡½æ•°çš„å®ç°æ–¹å¼ï¼Œä¸‹é¢ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯´æ˜ Node.js ä¸­ <strong><em>äº‹ä»¶</em></strong> å’Œ <strong><em>Promise</em></strong> å®ç°å¼‚æ­¥ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‹ä»¶ï¼ˆåŸºäºå›è°ƒå‡½æ•°ï¼‰å®ç°å¼‚æ­¥</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stream = fs.createReadStream(<span class="string">'./data'</span>);<span class="comment">// è°ƒç”¨ fs æ¨¡å—åˆ›å»ºä¸€ä¸ªè¯»å–æµå¯¹è±¡</span></span><br><span class="line">stream.on(<span class="string">'data'</span>,getData);<span class="comment">// è¯»å–äº‹ä»¶ï¼Œæ¯æ¬¡è¯»å–æ—¶è§¦å‘è°ƒç”¨å›è°ƒå‡½æ•° getData</span></span><br><span class="line">stream.on(<span class="string">'end'</span>,getDataDone);<span class="comment">// è¯»å–å®Œæ¯•è°ƒç”¨å›è°ƒå‡½æ•° getDataDone</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDataDone</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'read done!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“è¯»å–å¤šä¸ª <code>data</code> æ–‡ä»¶æ—¶ï¼Œè¾“å‡ºçš„å†…å®¹çš„é¡ºåºå¯èƒ½ä¸ä¸€è‡´ï¼Œå› ä¸ºäº‹ä»¶é‡‡ç”¨å›è°ƒå‡½æ•°å®ç°äº†å¼‚æ­¥æ“ä½œã€‚å¯ä»¥çœ‹å‡ºï¼Œäº‹ä»¶å®ç°å¼‚æ­¥ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>æ‰€è°“ Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<p>ä¸‹é¢æ¥çœ‹çœ‹ <code>Promise</code> çš„ä¸€ä¸ªå®ä¾‹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;<span class="comment">// ä½¿ç”¨ Promise ç”Ÿæˆå®ä¾‹</span></span><br><span class="line">    fs.readFile(<span class="string">'./1'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;<span class="comment">// readFile æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">            resolve(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;<span class="comment">// è°ƒç”¨å®ä¾‹çš„ then æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ES6 è§„å®šï¼ŒPromise å¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Promise å®ä¾‹ã€‚Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ <code>resolve</code> å’Œ <code>reject</code>ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p>
<ul>
<li>resolve : åœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›</li>
<li>reject  : åœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</li>
</ul>
<p>Promise å®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨ <code>then</code> æ–¹æ³•åˆ†åˆ«æŒ‡å®š Resolved çŠ¶æ€å’Œ Reject çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>æœ‰äº† Promise å¯¹è±¡ï¼Œå°±å¯ä»¥å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ã€‚æ­¤å¤–ï¼ŒPromise å¯¹è±¡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—æ§åˆ¶å¼‚æ­¥æ“ä½œæ›´åŠ å®¹æ˜“ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œåœ¨æœªä½¿ç”¨ <code>Promise</code> æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦ <code>p1</code> è¯»å–å®Œæ•°æ®åï¼Œç´§æ¥ç€ <code>p2</code> ã€<code>p3</code> è¯»å–ï¼Œå°±éœ€è¦åœ¨ <code>p1</code> çš„å›è°ƒè¯»å–æˆåŠŸå‡½æ•°é‡Œç»§ç»­å†™ <code>p2</code> çš„è¯»å–ï¼Œç±»ä¼¼çš„ <code>p3</code> ä¹Ÿè¦åœ¨ <code>p2</code> çš„å›è°ƒå‡½æ•°ä¸­å†™ï¼Œè¿™å°±é€ æˆäº† <strong><em>å±‚å±‚åµŒå¥—</em></strong> ä¸åˆ©äºä»£ç é˜…è¯»ã€‚è€Œä½¿ç”¨ <code>Promise</code> åï¼Œ<code>then</code> æ–¹æ³•æŠŠé‡Œé¢çš„å›è°ƒå‡½æ•°ç»Ÿä¸€æå–å‡ºæ¥ï¼Œ å¯è¯»æ€§æ›´å¥½äº†ï¼Œä¹Ÿæ–¹ä¾¿ç†è§£ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise æä¾›çš„ then æ–¹æ³•é¿å…å±‚æ¬¡åµŒå¥—ï¼Œç›¸å½“äºå®ç° then çš„é“¾å¼æ“ä½œ</span></span><br><span class="line"><span class="comment">// p1 æ‰§è¡Œå®Œ then æ–¹æ³•åï¼Œé€šè¿‡ return p2 ï¼Œè®© p2 ç»§ç»­æ‰§è¡Œ then æ–¹æ³•</span></span><br><span class="line">p1.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="keyword">return</span> p2;</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> p2;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="keyword">return</span> p3;</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> p3;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>æ›´å¤š Promise è¯­æ³•ï¼Œå¯ä»¥å‚è€ƒé˜®ä¸€å³°çš„ã€Š<a href="http://es6.ruanyifeng.com/#docs/promise#åŸºæœ¬ç”¨æ³•" target="_blank" rel="noopener">ECMAScript 6 å…¥é—¨</a>ã€‹ã€‚</p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/01/04/Node.JS-å­¦ä¹ ç¬”è®°-[03]----Buffer-fs-path/" class="prev">PREV</a><a href="/2015/01/02/Node.JS-å­¦ä¹ ç¬”è®°-[01]----å…¥é—¨/" class="next">NEXT</a></div><div class="copyright"><p>Â© 2015 - 2019 Made with <span>â¤</span> by <a href="https://github.com/ifyour/ifyour.github.io">Ifyour</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script><script>new Darkmode({
    bottom: '1rem',
    right: '1rem',
    left: 'unset',
    time: '0.5s',
    mixColor: '#fff',
    backgroundColor: '#fff',
    buttonColorDark: '#100f2c',
    buttonColorLight: '#fff',
    saveInCookies: true,
    label: 'ğŸŒ“',
    autoMatchOsTheme: true
}).showWidget();
</script><script src="/js/algoliasearch.min.js"></script><script src="/js/template-web.min.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/medium-zoom@0/dist/medium-zoom.min.js"></script><script>mediumZoom('article img', {margin: 24});
(function(win, targetElem) {
    if (!targetElem) return;
    win.onscroll = (function() {
        if (isElementInViewport(targetElem)) {
            win.onscroll = null;
            return mediumZoom('.gitment-comment-main img', {margin: 24});
        }
        return arguments.callee;
    })();
    function isElementInViewport(el) {
        var rect = el.getBoundingClientRect();
        var winH = win.innerHeight || document.documentElement.clientHeight;
        return rect.top <= winH && rect.bottom >= winH;
    };
})(this, document.querySelector('#gc_container'));
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-120929321-1",'auto');ga('send','pageview');</script></footer></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>