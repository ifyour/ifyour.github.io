<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ifyour's Blog"><meta name="msapplication-TileImage" content="/img/webAppIcon-256x256.png"><meta name="msapplication-TileColor" content="#000"><meta property="algolia:search" data-application-id="3XQ5CPDDMK" data-api-key="abe9e26eebcac723f34ade5cf6b97441" data-index-name="prod_blog"><title>Node.JS 学习笔记 [05] -- Express · Ifyour's Blog</title><meta name="description" content="Node.JS 学习笔记 [05] -- Express - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="apple-touch-icon" size="256x256" href="/img/webAppIcon-256x256.png"><link rel="apple-touch-icon" size="512x512" href="/img/webAppIcon-512x512.png"><link rel="apple-touch-startup-image" href="/img/apple-launch-750x1334.png"><link rel="preload" href="/css/apollo.css" as="style"><link rel="preload" href="/js/main.js" as="script"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="search"><a href="javascript:;" target="_self" class="close"><svg id="icon-close" viewbox="0 0 16 16" width="24" height="24" fill="#A4A9AC"><path d="M8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 Z M10.44352,10.7233105 L10.4528296,10.7326201 L10.7326201,10.4528296 C11.0310632,10.1543865 11.0314986,9.66985171 10.7335912,9.37194437 L9.36507937,8.0034325 L10.7360526,6.63245928 C11.0344957,6.33401613 11.0349311,5.84948135 10.7370237,5.55157401 L10.448426,5.26297627 C10.1505186,4.96506892 9.66598387,4.96550426 9.36754072,5.26394741 L8.00589385,6.62559428 L6.63738198,5.25708241 C6.33947464,4.95917507 5.85493986,4.95961041 5.55649671,5.25805356 L5.26737991,5.54717036 C4.96893676,5.84561351 4.96850142,6.33014829 5.26640876,6.62805563 L6.62561103,7.9872579 L5.25463781,9.35823112 C4.95619466,9.65667427 4.95575932,10.141209 5.25366666,10.4391164 L5.5422644,10.7277141 C5.84017175,11.0256215 6.32470652,11.0251861 6.62314967,10.726743 L7.99412289,9.35576976 L9.36263476,10.7242816 C9.66054211,11.022189 10.1450769,11.0217536 10.44352,10.7233105 Z"/></svg></a><div class="container"><input id="search-input" autocomplete="off" type="text" placeholder="Type to search" class="search-input"><div class="search-by">Search by<a href="https://www.algolia.com/" target="_blank"> algolia</a></div><div class="search-results"><div id="search-articles" class="search-item"></div></div></div><script id="search-tmp" type="text/html">{{if list.length}}
    <h3>ARTICLES</h3>
    <ul>
        {{each list item}}
        <li>
            <div class="search-item-title">
                <a href="{{item.permalink}}">{{@item.title}}</a>
            </div>
            <div class="search-item-summary" style="-webkit-box-orient: vertical;">
                {{@item.summary}}
            </div>
        </li>
        {{/each}}
    </ul>
{{else if list}}
    <h2>
        Oops! no result,
        Try it on <a target="_blank" style="color: #2c3e50; border-bottom: 2px solid #42b983; font-size: 19px;" href="https://www.google.com/search?q=site%3Aifyour.github.io+{{keywords}}">Google: {{keywords}}</a>~ 😱
    </h2>
{{/if}}</script></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/docs/" target="_self" class="nav-list-link">DOCS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="javascript:;" target="_self" id="search" class="nav-list-link">SEARCH</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node.JS 学习笔记 [05] -- Express</h1><div class="post-info">Jan 6, 2015</div><div class="sidebar-toc"><span>Catalog</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-安装"><span class="toc-text">Express 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#在项目中引入-Express"><span class="toc-text">在项目中引入 Express</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-Express-generator"><span class="toc-text">使用 Express-generator</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-路由"><span class="toc-text">Express 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础用法"><span class="toc-text">基础用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Router-方法"><span class="toc-text">Router 方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-响应对象"><span class="toc-text">Express 响应对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#send"><span class="toc-text">send()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#json"><span class="toc-text">json()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#render"><span class="toc-text">render()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#download"><span class="toc-text">download()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redirect"><span class="toc-text">redirect()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-请求对象"><span class="toc-text">Express 请求对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#URL-中的参数"><span class="toc-text">URL 中的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#表单中的参数"><span class="toc-text">表单中的参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-中间件"><span class="toc-text">Express 中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#应用级中间件"><span class="toc-text">应用级中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#内置中间件"><span class="toc-text">内置中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三方中间件"><span class="toc-text">第三方中间件</span></a></li></ol></li></ol></div><div class="post-content"><p><strong><em>Express</em></strong> 是一个基于 Node.js 平台的极简、灵活的 Web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。Express 的核心特性可以概括以下三点。<br><a id="more"></a></p>
<ul>
<li>可以设置中间件来响应 HTTP 请求。</li>
<li>定义了路由表用于执行不同的 HTTP 请求动作。</li>
<li>可以通过向模板传递参数来动态渲染 HTML 页面。</li>
</ul>
<p>下面学习的知识点，都会围绕这几个特性展开。</p>
<h3 id="Express-安装"><a href="#Express-安装" class="headerlink" title="Express 安装"></a>Express 安装</h3><h4 id="在项目中引入-Express"><a href="#在项目中引入-Express" class="headerlink" title="在项目中引入 Express"></a>在项目中引入 Express</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> projectName              <span class="comment"># 进入新建的 Node.js 项目</span></span><br><span class="line">npm init                    <span class="comment"># 初始化项目配置文件</span></span><br><span class="line">npm install express --save  <span class="comment"># 安装 Express 模块到项目配置文件中</span></span><br></pre></td></tr></table></figure>
<p>通过上门的命令，就可以完成 Express 的安装，下面在 <code>app.js</code> 中使用 Express 吧！<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'Hello,Express!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Express running at http://127.0.0.1:8080/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="使用-Express-generator"><a href="#使用-Express-generator" class="headerlink" title="使用 Express-generator"></a>使用 Express-generator</h4><p>为了方便开发者，更便捷的使用 Express 生成项目，官方提供的快速的生成工具 <code>Express-generator</code>，虽然生成非常快速方便，但是作为初学者，还是要弄清楚里面每条命令所代表的含义，最后再使用官方提供的工具快速生成。打开终端，因为我是 MacOS，所以安装的时候要加上 <code>sudo</code> 否则会报错提示权限不够。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install express-generator -g  <span class="comment"># 全局安装</span></span><br><span class="line">express mywebapp                       <span class="comment"># 创建 mywebapp 项目</span></span><br><span class="line"><span class="built_in">cd</span> mywebapp &amp;&amp; npm install             <span class="comment"># 安装依赖文件</span></span><br><span class="line">npm start                              <span class="comment"># 启动项目</span></span><br></pre></td></tr></table></figure></p>
<p>启动项目后，就可以在浏览器中预览了，访问地址：<a href="http://127.0.0.1:3000/" target="_blank" rel="noopener">http://127.0.0.1:3000/</a> 。</p>
<div class="tip"><br>启动前需要关闭其它已经启用的 Web 服务，否则可能会导致端口占用启动不成功。<br></div>

<h3 id="Express-路由"><a href="#Express-路由" class="headerlink" title="Express 路由"></a>Express 路由</h3><blockquote>
<p>路由是指如何定义应用的端点（URLs）以及如何响应客户端的请求。</p>
</blockquote>
<h4 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h4><p>简单理解，其实就是根据不同的请求，来响应与之对应的页面。比如，当用户访问 <a href="http://localhost/images/" target="_blank" rel="noopener">http://localhost/images/</a> 时，根据 URL 可以看出，请求的是 <code>/images</code> 这个目录，那么通过路由，找到这个页面并返回给请求的用户，这个过程就叫路由。来看一个简单的例子。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当用户请求访问 / 时，响应一个 Hello,Express! 字符串，这就是一个简单路由</span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'Hello,Express!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意 <code>app.all()</code> ,它是一个特殊的路由方法，没有任何 HTTP 方法与其对应，它的作用是对于一个路径上的所有请求加载中间件。 all 相当于既可以处理 <code>GET</code>，也可以处理 <code>POST</code> 。</p>
<h4 id="Router-方法"><a href="#Router-方法" class="headerlink" title="Router 方法"></a>Router 方法</h4><p>通过 <code>express.Router</code> 类可以创建独立模块的路由模块，它是一个可以挂载的路由对象，把路由模块分离出项目，让整个项目结构清晰、方便管理，这里光说还是挺抽象，举个例子。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目录结构</span></span><br><span class="line">.</span><br><span class="line">├── index.js</span><br><span class="line">├── node_modules</span><br><span class="line">│   ├── body-parser</span><br><span class="line">│   └── express</span><br><span class="line">├── package.json</span><br><span class="line">├── router</span><br><span class="line">│   ├── admin.js</span><br><span class="line">│   └── home.js</span><br><span class="line">└── views</span><br><span class="line">    ├── admin</span><br><span class="line">    └── home</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> bodyparser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="comment">// 引入外部路由模块</span></span><br><span class="line"><span class="keyword">var</span> home = <span class="built_in">require</span>(<span class="string">'./router/home'</span>);</span><br><span class="line"><span class="keyword">var</span> admin = <span class="built_in">require</span>(<span class="string">'./router/admin'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用中间件 bodyparser ，后面可以在 req.body 中分析出 POST 请求体的内容</span></span><br><span class="line">app.use(bodyparser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用外部路由模块</span></span><br><span class="line">app.use(<span class="string">'/'</span>,home);</span><br><span class="line">app.use(<span class="string">'/admin'</span>,admin);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'visit http://127.0.0.1:8080/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// admin.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();<span class="comment">// 用 Router 构造函数实例化 router 对象</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/login.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(path.resolve(__dirname + <span class="string">'/../views/admin/'</span> + <span class="string">'login.html'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/user.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(path.resolve(__dirname + <span class="string">'/../views/admin/'</span> + <span class="string">'user.html'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/login.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;<span class="comment">// /admin/login.html</span></span><br><span class="line">    res.sendFile(path.resolve(__dirname + <span class="string">'/../views/admin/'</span> + <span class="string">'login.html'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;<span class="comment">// 暴露给外部调用该路由</span></span><br></pre></td></tr></table></figure>
<h3 id="Express-响应对象"><a href="#Express-响应对象" class="headerlink" title="Express 响应对象"></a>Express 响应对象</h3><p>通过响应（Response）对象，服务器可以返回一个来自客户端（浏览器）的 <code>Request</code> ,最终返回给用户的其实就是一个经过业务逻辑层处理的 <code>res</code> 对象。来了解下 Express 的响应对象吧。</p>
<h4 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h4><p>Express 已经封装过了原生 Node.js 的响应方法，在原生 Node.js 中，通过 <code>res.write()</code> 方法可以返回字符串和 Buffer。而 Express 中的 <code>send()</code> 可以返回任意数据类型，如流、数据、普通文本等，来看个例子。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res.send(<span class="keyword">new</span> Buffer(<span class="string">'ifyour'</span>)); <span class="comment">// Buffer</span></span><br><span class="line">res.send(&#123;<span class="string">"name"</span>: <span class="string">"ifyour"</span>&#125;);   <span class="comment">// JSON</span></span><br><span class="line">res.send(<span class="string">'&lt;p&gt;some html&lt;/p&gt;'</span>);   <span class="comment">// HTML</span></span><br><span class="line">res.status(<span class="number">404</span>).send(<span class="string">'404 Not Find'</span>); <span class="comment">// 设置状态码并返回提示</span></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></p>
<h4 id="json"><a href="#json" class="headerlink" title="json()"></a>json()</h4><p>通过 <code>json()</code> 方法可以返回一个 <code>JSON</code> 对象，用于 Ajax 等。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.json(<span class="literal">null</span>);</span><br><span class="line">res.json(&#123;<span class="string">"user"</span>: <span class="string">"ifyour"</span>&#125;);</span><br><span class="line">res.status(<span class="number">500</span>).json(&#123;<span class="string">"error"</span>: <span class="string">"message"</span>&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="render"><a href="#render" class="headerlink" title="render()"></a>render()</h4><p><code>render</code> 用于渲染模板引擎，比如在使用 <a href="https://github.com/tj/ejs" target="_blank" rel="noopener">ejs</a> 模板引擎时，响应用户请求就可以使用 <code>res.render()</code> 返回给用户一个渲染好的页面。这个用的比较多，我来举个例子。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目录结构</span></span><br><span class="line">.</span><br><span class="line">├── index.js</span><br><span class="line">├── node_modules</span><br><span class="line">│   ├── ejs</span><br><span class="line">│   └── express</span><br><span class="line">├── package.json</span><br><span class="line">└── views</span><br><span class="line">    └── login.html</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ejs 模板引擎，定义了 /login.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意 ejs 模板中变量的写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎你，<span class="tag">&lt;<span class="name">%=name%</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>); <span class="comment">// 引入 ejs 模板引擎</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> viewsPath = path.join(__dirname, <span class="string">'views'</span>);<span class="comment">// views 是模板目录</span></span><br><span class="line"><span class="comment">// 设置 express views 层，模板根路径</span></span><br><span class="line">app.set(<span class="string">'views'</span>, viewsPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 express 实例的模板语言</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'html'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 express 实例的模板引擎和 ejs 模板引擎关联</span></span><br><span class="line">app.engine(<span class="string">'html'</span>, ejs.__express);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/login.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'login'</span>, &#123;<span class="attr">name</span>: <span class="string">"ifyour"</span>&#125;);<span class="comment">// 替换到模板变量中的 name 为 ifyour</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'visit http://127.0.0.1:8080/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<div class="tip"><br><code>__dirname</code> 是 Node.js 中定义的 <code>global</code> 全局变量，获取当前文件的绝对路径，返回 <code>string</code> 类型。<br></div>

<h4 id="download"><a href="#download" class="headerlink" title="download()"></a>download()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.download(<span class="string">'./123.doc'</span>); <span class="comment">// 下载当前目录下面的123.doc文件。</span></span><br><span class="line">res.download(<span class="string">'./123.doc'</span>,<span class="string">'books.doc'</span>); <span class="comment">// 下载当前目录下面的123.doc文件，重命名为 books.doc</span></span><br></pre></td></tr></table></figure>
<h4 id="redirect"><a href="#redirect" class="headerlink" title="redirect()"></a>redirect()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重定向到指定的 URL 路径</span></span><br><span class="line">res.redirect(<span class="string">'/404.html'</span>);</span><br><span class="line">res.redirect(<span class="string">'https://www.google.com/'</span>);</span><br></pre></td></tr></table></figure>
<p>更多响应对象的方法，参考 <a href="http://www.expressjs.com.cn/4x/api.html#res" target="_blank" rel="noopener">Express 官方 API</a>。</p>
<h3 id="Express-请求对象"><a href="#Express-请求对象" class="headerlink" title="Express 请求对象"></a>Express 请求对象</h3><p>Express 中的 <code>Request</code> 对象，包含了一次请求中的所有数据，比如请求头、路径、Cookies 等，获取请求头中的信息，服务器根据这些信息处理业务逻辑层，最终将处理过后的数据返回给用户。这里总结了常用的请求对象方法。</p>
<h4 id="URL-中的参数"><a href="#URL-中的参数" class="headerlink" title="URL 中的参数"></a>URL 中的参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一： req.query.参数名</span></span><br><span class="line"><span class="comment">// e.g.  http://localhost:3000/user?name=ifyour</span></span><br><span class="line"><span class="built_in">console</span>.log(req.query.name);</span><br><span class="line"><span class="comment">// =&gt; ifyour</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：req.params.参数名</span></span><br><span class="line"><span class="comment">//e.g.  http://localhost/post/123123</span></span><br><span class="line">router.get(<span class="string">'/post/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.params.id);</span><br><span class="line">    <span class="comment">// =&gt; 123123</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="表单中的参数"><a href="#表单中的参数" class="headerlink" title="表单中的参数"></a>表单中的参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一：语法：req.param.参数名  注意这里没加 s</span></span><br><span class="line"><span class="comment">// e.g. &lt;input type="text" name="user"&gt;</span></span><br><span class="line"><span class="built_in">console</span>.log(req.param(<span class="string">'user'</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：使用 body-parser 中间件</span></span><br><span class="line"><span class="comment">// e.g. &lt;input type="text" name="user"&gt;</span></span><br><span class="line"><span class="keyword">var</span> bodyparser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="built_in">console</span>.console.log(req.boy.user);</span><br></pre></td></tr></table></figure>
<h3 id="Express-中间件"><a href="#Express-中间件" class="headerlink" title="Express 中间件"></a>Express 中间件</h3><p>Express 是一个自身功能极简，完全是由路由和中间件构成一个的 Web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。<br><img src="http://ww3.sinaimg.cn/large/6057861cgw1fbcrpk71zxj20sg03kaaa.jpg" alt><br>如图，中间件（Middleware）位于客户端和路由之间，它好比是一个漏斗，经过这个漏斗的 <code>Request</code> 对象和 <code>Response</code> 对象以及循环流程中的 <code>Next</code> 会被处理，比如正确性校验、业务逻辑处理等。</p>
<ul>
<li>执行任何代码</li>
<li>修改请求和响应对象</li>
<li>终结请求-响应循环</li>
<li>调用堆栈中的下一个中间件</li>
</ul>
<p><div class="tip"><br>如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。<br></div><br>举个例子来说明一下，如何通过 <code>next()</code> 方法把控制权交给下一个中间件。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> accessToken = req.query.accessToken;</span><br><span class="line">   <span class="comment">//检查请求中是否含有“认证牌”，存在就继续执行。</span></span><br><span class="line">   <span class="keyword">if</span>(accessToken)&#123;</span><br><span class="line">       next(); <span class="comment">// 执行下一个中间件</span></span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          res.send(“请求必须包含token”);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></p>
<h4 id="应用级中间件"><a href="#应用级中间件" class="headerlink" title="应用级中间件"></a>应用级中间件</h4><p>应用级中间件就是绑定到用 <code>express()</code> 生成的对象 <code>app</code> 身上的，比如 <code>app.use()</code> 中的 <code>use</code> 方法，以及 <code>app.post()</code> 、<code>app.get()</code> 中的 <code>POST</code> 和 <code>GET</code> 方法等。</p>
<h4 id="内置中间件"><a href="#内置中间件" class="headerlink" title="内置中间件"></a>内置中间件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置公共静态目录，用于存放 css js image 等文件，项目目录里有 images 目录存放 1.png</span></span><br><span class="line"><span class="comment">// 那么访问：http://localhost/images/1.png 获取</span></span><br><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br></pre></td></tr></table></figure>
<h4 id="第三方中间件"><a href="#第三方中间件" class="headerlink" title="第三方中间件"></a>第三方中间件</h4><p>中间件可以说是整个 Express 的精华所在了，使用中间件可以几大的扩展项目的功能。使用方法都差不多，这里介绍几个常用的，具体使用方式需要看官方的文档了。</p>
<ul>
<li>解析客户端请求的 body 中的内容：body-parser</li>
<li>cookie 解析中间件：cookie-parser</li>
<li>文件上传中间件：multer</li>
</ul>
<p>使用命令 <code>npm i 包名称 --save</code> 安装到项目中，然后引入项目使用即可。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/01/05/Mongodb-学习笔记----增删改查/" class="prev">PREV</a><a href="/2015/01/05/Node.JS-学习笔记-[04]----HTTP/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 Made with <span>❤</span> by <a href="https://github.com/ifyour/ifyour.github.io">Ifyour</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script><script>new Darkmode({
    bottom: '1rem',
    right: '1rem',
    left: 'unset',
    time: '0.5s',
    mixColor: '#fff',
    backgroundColor: '#fff',
    buttonColorDark: '#100f2c',
    buttonColorLight: '#fff',
    saveInCookies: true,
    label: '🌓',
    autoMatchOsTheme: true
}).showWidget();
</script><script src="/js/algoliasearch.min.js"></script><script src="/js/template-web.min.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/medium-zoom@0/dist/medium-zoom.min.js"></script><script>mediumZoom('article img', {margin: 24});
(function(win, targetElem) {
    if (!targetElem) return;
    win.onscroll = (function() {
        if (isElementInViewport(targetElem)) {
            win.onscroll = null;
            return mediumZoom('.gitment-comment-main img', {margin: 24});
        }
        return arguments.callee;
    })();
    function isElementInViewport(el) {
        var rect = el.getBoundingClientRect();
        var winH = win.innerHeight || document.documentElement.clientHeight;
        return rect.top <= winH && rect.bottom >= winH;
    };
})(this, document.querySelector('#gc_container'));
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-120929321-1",'auto');ga('send','pageview');</script></footer></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>