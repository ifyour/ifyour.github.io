<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ifyour's Blog"><meta name="msapplication-TileImage" content="/img/webAppIcon-256x256.png"><meta name="msapplication-TileColor" content="#000"><meta property="algolia:search" data-application-id="3XQ5CPDDMK" data-api-key="abe9e26eebcac723f34ade5cf6b97441" data-index-name="prod_blog"><title>Mongodb 学习笔记 -- 增删改查 · Ifyour's Blog</title><meta name="description" content="Mongodb 学习笔记 -- 增删改查 - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="apple-touch-icon" size="256x256" href="/img/webAppIcon-256x256.png"><link rel="apple-touch-icon" size="512x512" href="/img/webAppIcon-512x512.png"><link rel="apple-touch-startup-image" href="/img/apple-launch-750x1334.png"><link rel="preload" href="/css/apollo.css" as="style"><link rel="preload" href="/js/main.js" as="script"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="search"><a href="javascript:;" target="_self" class="close"><svg id="icon-close" viewbox="0 0 16 16" width="24" height="24" fill="#A4A9AC"><path d="M8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 Z M10.44352,10.7233105 L10.4528296,10.7326201 L10.7326201,10.4528296 C11.0310632,10.1543865 11.0314986,9.66985171 10.7335912,9.37194437 L9.36507937,8.0034325 L10.7360526,6.63245928 C11.0344957,6.33401613 11.0349311,5.84948135 10.7370237,5.55157401 L10.448426,5.26297627 C10.1505186,4.96506892 9.66598387,4.96550426 9.36754072,5.26394741 L8.00589385,6.62559428 L6.63738198,5.25708241 C6.33947464,4.95917507 5.85493986,4.95961041 5.55649671,5.25805356 L5.26737991,5.54717036 C4.96893676,5.84561351 4.96850142,6.33014829 5.26640876,6.62805563 L6.62561103,7.9872579 L5.25463781,9.35823112 C4.95619466,9.65667427 4.95575932,10.141209 5.25366666,10.4391164 L5.5422644,10.7277141 C5.84017175,11.0256215 6.32470652,11.0251861 6.62314967,10.726743 L7.99412289,9.35576976 L9.36263476,10.7242816 C9.66054211,11.022189 10.1450769,11.0217536 10.44352,10.7233105 Z"/></svg></a><div class="container"><input id="search-input" autocomplete="off" type="text" placeholder="Type to search" class="search-input"><div class="search-by">Search by<a href="https://www.algolia.com/" target="_blank"> algolia</a></div><div class="search-results"><div id="search-articles" class="search-item"></div></div></div><script id="search-tmp" type="text/html">{{if list.length}}
    <h3>ARTICLES</h3>
    <ul>
        {{each list item}}
        <li>
            <div class="search-item-title">
                <a href="{{item.permalink}}">{{@item.title}}</a>
            </div>
            <div class="search-item-summary" style="-webkit-box-orient: vertical;">
                {{@item.summary}}
            </div>
        </li>
        {{/each}}
    </ul>
{{else if list}}
    <h2>
        Oops! no result,
        Try it on <a target="_blank" style="color: #2c3e50; border-bottom: 2px solid #42b983; font-size: 19px;" href="https://www.google.com/search?q=site%3Aifyour.github.io+{{keywords}}">Google: {{keywords}}</a>~ 😱
    </h2>
{{/if}}</script></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/docs/" target="_self" class="nav-list-link">DOCS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="javascript:;" target="_self" id="search" class="nav-list-link">SEARCH</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Mongodb 学习笔记 -- 增删改查</h1><div class="post-info">Jan 5, 2016</div><div class="sidebar-toc"><span>Catalog</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mongodb-介绍"><span class="toc-text">Mongodb 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mongodb-安装"><span class="toc-text">Mongodb 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mongodb-使用"><span class="toc-text">Mongodb 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础命令"><span class="toc-text">基础命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GUI-工具"><span class="toc-text">GUI 工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mongoose-介绍"><span class="toc-text">Mongoose 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新增数据"><span class="toc-text">新增数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除数据"><span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询数据"><span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改数据"><span class="toc-text">修改数据</span></a></li></ol></li></ol></div><div class="post-content"><p>记录 Mongodb 的学习之旅，从环境配置，到基础命令行使用，算是一个简单的入门教程，同时也是学习总结，还有把踩到的坑都记录下来，以后遇到同样的问题不至于在同一个地方继续踩坑。<br><a id="more"></a></p>
<h3 id="Mongodb-介绍"><a href="#Mongodb-介绍" class="headerlink" title="Mongodb 介绍"></a>Mongodb 介绍</h3><blockquote>
<p>MongoDB 是一种文档导向<strong><em>数据库管理系统</em></strong>，由 C++撰写而成，旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。2007 年 10 月，MongoDB 由 10gen 团队所发展。2009 年 2 月首度推出。 — <strong><em>维基百科</em></strong></p>
</blockquote>
<p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。听着很饶，其实就是非关系数据库。那什么又是 <strong><em>关系型数据库</em></strong> 呢？关系型数据库以行和列的形式存储数据，这一系列的行和列被称为表，一组表组成了数据库。表与表之间的数据记录有关系。</p>
<h3 id="Mongodb-安装"><a href="#Mongodb-安装" class="headerlink" title="Mongodb 安装"></a>Mongodb 安装</h3><p>本人的操作系统是：MacOS，且已经安装了 <a href="http://brew.sh/index_zh-cn.html" target="_blank" rel="noopener">brew</a> ，所以图省事，我就使用 brew 一键安装了。没用过 brew 的同学可以去<a href="http://www.cnblogs.com/TankXiao/p/3247113.html" target="_blank" rel="noopener">这里看看</a>，用起来还是挺方便的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install mongodb</span><br></pre></td></tr></table></figure>
<p>安装速度取决于你的网络情况，这里稍等片刻。brew 默认的安装位置在 <code>/usr/local/Cellar/</code> 一会的功夫，我们就能在这里看到，Mongodb 乖乖的躺在这了。因为 Mongodb 会默认读取 <code>/data/db</code> 目录下的数据库，所以方便省事，我们把默认的数据库就创建在这个位置，并且给 <code>/data</code> 执行权限，执行以下命令即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /data/db         <span class="comment"># sudo 表示以管理员权限运行，-p 表示创建多层目录</span></span><br><span class="line">sudo chown -R  UserName /data  <span class="comment"># UserName 表示你当前的系统用户名</span></span><br></pre></td></tr></table></figure>
<p>安装成功后，就可以在 Mongodb 的安装目录下 找到 <code>bin</code> 目录了，这里面放着所有需要用到的命令。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/Cellar/mongodb/3.4.0/bin</span><br><span class="line">./mongod   <span class="comment"># 执行 Mongodb 进程后，浏览器打开 http://127.0.0.1:27017/</span></span><br></pre></td></tr></table></figure></p>
<p>浏览器显示下面的内容，就表示安装成功啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It looks like you are trying to access MongoDB over HTTP on the native driver port.</span><br></pre></td></tr></table></figure></p>
<p>接下来打开终端，执行下面的命令，验证我们确实安装成功了。在 Mongodb 的控制台中，可以执行很多命令来操作数据库。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/Cellar/mongodb/3.4.0/bin</span><br><span class="line">./mongo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入 MongoDB shell 后，光标会变成下面过的状态，执行 show dbs 后，显示如下则大功告成！</span></span><br><span class="line">&gt; show dbs</span><br><span class="line">admin  0.000GB</span><br><span class="line"><span class="built_in">local</span>  0.000GB</span><br></pre></td></tr></table></figure></p>
<p>接下来，为了方便下次执行 Mongodb ，我们把 <code>bin</code> 目录放到环境变量中，这样下次直接在终端输入 <code>mongod</code> 即可启用服务，输入命令 <code>mongo</code> 即可进入 shell 控制台。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加环境变量，语法：echo "export PATH=xxxxxx:$PATH" &gt;&gt; ~/.bash_profile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=/usr/local/Cellar/mongodb/3.4.0/bin:$PATH'</span>&gt;&gt;~/.bash_profile</span><br></pre></td></tr></table></figure>
<h3 id="Mongodb-使用"><a href="#Mongodb-使用" class="headerlink" title="Mongodb 使用"></a>Mongodb 使用</h3><p>使用之前，在明白几个概念，相比关系型数据库，非关系数据库采用了 <strong><em>数据库</em></strong>、<strong><em>集合</em></strong>、<strong><em>文档</em></strong>、的概念。其实对比 SQL 数据库，就很容易理解，集合就好比是一张表，文档好比就是一整行数据。库的概念是一致的。就这点区别。在终端输入 <code>mongo</code> 进入 shell 控制台。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure></p>
<h4 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h4><p>新增数据</p>
<ul>
<li>显示数据库：<code>show dbs</code></li>
<li>使用/创建数据库：<code>use 数据库名</code></li>
<li>显示集合：<code>show collections</code></li>
<li>保存数据：<code>db.collection.save({&quot;key&quot;:&quot;value&quot;,&quot;key2&quot;:&quot;value2&quot;})</code></li>
<li>插入数据：<code>db.collection.insert({&quot;key&quot;:&quot;value&quot;,&quot;key2&quot;:&quot;value2&quot;})</code></li>
</ul>
<div class="tip"><br>若新增的数据主键已经存在，insert()会不做操作并提示错误，而save()则更改原来的内容为新内容。<br></div>

<p>删除数据</p>
<ul>
<li>删除所有文档：<code>db.collection.remove({})</code></li>
<li>删除指定文档：<code>db.collection.remove({&quot;key&quot;:&quot;value&quot;})</code></li>
<li>删除集合：<code>db.collection.drop()</code> 或者 <code>db.runCommand({&quot;drop&quot;:&quot;collection&quot;})</code></li>
<li>删除数据库：<code>db.runCommand({&quot;dropDatabase&quot;: 1})</code> 注意：1 没有引号</li>
</ul>
<p>查找数据</p>
<ul>
<li>查找所有数据： <code>db.collection.find({})</code></li>
<li>查到单条数据：<code>db.collection.findOne({})</code></li>
<li>条件查找：<code>db.collection.find({&quot;key&quot;:&quot;value&quot;})</code></li>
<li>条件查找 key &lt; value：<code>db.collection.find({&quot;key&quot;:{$lt:value}})</code></li>
<li>条件查找 key &gt; value：<code>db.collection.find({&quot;key&quot;:{$gt:value}})</code></li>
<li>条件查找 key &gt;= value：<code>db.collection.find({&quot;key&quot;:{$gte:value}})</code></li>
<li>范围查找：<code>db.collection.find({&quot;key&quot;:{$gt:value1,$lt:value2 } })</code></li>
<li>模运算查找：<code>db.collection.find({&quot;key&quot;:{$mod:[10,1]}})</code></li>
<li>范围在查找：<code>db.collection.find({&quot;key&quot;:{$in:[1,2,3]}})</code></li>
<li>范围不在在查找：<code>db.collection.find({&quot;key&quot;:{$nin:[1,2,3]}})</code></li>
<li>数组长度查找：<code>db.collection.find({&quot;key&quot;:{$size:1}})</code> key 必须是数组</li>
<li>字段存在查找：<code>db.collection.find({&quot;key&quot;:{$exists:true|false}})</code></li>
<li>多条件查找：<code>db.collection.find({$or:[{a:1},{b:2}]})</code></li>
<li>内嵌对象中的值查找：<code>db.collection.find({&quot;key.subkey&quot;:value})</code></li>
<li>排序：<code>db.collection.find({}).sort({&quot;key1&quot;:1,&quot;key2&quot;:-1})</code> 1 升序 -1 降序</li>
<li>对字段建立索引：<code>db.collection.find({})ensureIndex({&quot;key&quot;:1})</code> 1 升序 -1 降序</li>
<li>范围控制查找：<code>db.collection.find().skip(5).limit(5)</code> 跳过 5 条，读取 5 条</li>
<li>查询结果集统计：<code>db.collection.find().count()</code></li>
<li>模糊查找：<code>db.collection.find({&quot;key&quot;:/ab/})</code> 正则</li>
</ul>
<p>更改数据</p>
<ul>
<li><code>db.collection.update({&quot;targetKey&quot;:&quot;targetValue&quot;},{&quot;newKey&quot;:&quot;newVlue&quot;})</code></li>
</ul>
<h4 id="GUI-工具"><a href="#GUI-工具" class="headerlink" title="GUI 工具"></a>GUI 工具</h4><p><img src="http://ww1.sinaimg.cn/large/6057861cgw1fbfwwdbu8qj20zq0dbqah.jpg" alt><br><strong><em>Robomongo</em></strong> 可视化 Mongodb 数据库管理工具 ，点击<a href="https://robomongo.org/download" target="_blank" rel="noopener">这里</a>下载，官方网站：<a href="https://robomongo.org/" target="_blank" rel="noopener">https://robomongo.org/</a> 。</p>
<h3 id="Mongoose-介绍"><a href="#Mongoose-介绍" class="headerlink" title="Mongoose 介绍"></a>Mongoose 介绍</h3><p><a href="http://mongoosejs.com/" target="_blank" rel="noopener">Mongoose</a> 简而言之就是在 Node 环境中操作 MongoDB 数据库的一种对象模型工具，Mongoose 将数据库中的数据转换为 JavaScript 对象供开发人员使用。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>安装 Mongoose<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongoose --save</span><br></pre></td></tr></table></figure></p>
<p>引入到项目文件中并创建链接<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/my_database'</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.createConnection(<span class="string">'mongodb://127.0.0.1:27017/test'</span>);</span><br><span class="line"><span class="comment">// 设置数据类型</span></span><br><span class="line"><span class="keyword">var</span> monSchema = <span class="keyword">new</span> mongooose.Schema(&#123;</span><br><span class="line">    name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">default</span>:<span class="string">"username"</span>&#125;,</span><br><span class="line">    age：&#123;<span class="attr">type</span>:<span class="built_in">Number</span>&#125;,</span><br><span class="line">    sex:&#123;<span class="attr">type</span>:<span class="built_in">String</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 选择集合</span></span><br><span class="line"><span class="keyword">var</span> monModel = db.model(<span class="string">'user'</span>,monSchema);</span><br><span class="line"><span class="comment">// 数据集</span></span><br><span class="line"><span class="keyword">var</span> content = &#123;<span class="attr">name</span>:<span class="string">"Nick"</span>,<span class="attr">age</span>:<span class="number">23</span>,<span class="attr">sex</span>:<span class="string">'男'</span>&#125;;</span><br><span class="line"><span class="comment">// 实例化对象并插入数据</span></span><br><span class="line"><span class="keyword">var</span> monInsert = <span class="keyword">new</span> monModel(content);</span><br><span class="line">monInsert.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功插入数据'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.createConnection(<span class="string">'mongodb://127.0.0.1:27017/test'</span>);</span><br><span class="line"><span class="comment">// cosole.log(db);</span></span><br><span class="line"><span class="comment">// 设置数据类型</span></span><br><span class="line"><span class="keyword">var</span> monSchema = <span class="keyword">new</span> mongooose.Schema(&#123;</span><br><span class="line">    name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">default</span>:<span class="string">"name"</span>&#125;,</span><br><span class="line">    age：&#123;<span class="attr">type</span>:<span class="built_in">Number</span>&#125;,</span><br><span class="line">    sex:&#123;<span class="attr">type</span>:<span class="built_in">String</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 选择集合</span></span><br><span class="line"><span class="keyword">var</span> monModel = db.model(<span class="string">'user'</span>,monSchema);</span><br><span class="line"><span class="comment">// 原数据字段值</span></span><br><span class="line"><span class="keyword">var</span> oldValue  = &#123;<span class="attr">name</span>:<span class="string">"Nick"</span>&#125;;</span><br><span class="line"><span class="comment">// 单条件更新</span></span><br><span class="line"><span class="keyword">var</span> newData1 = &#123;<span class="attr">$set</span>:&#123;<span class="attr">name</span>:<span class="string">"内容"</span>&#125;&#125;;</span><br><span class="line"><span class="comment">// 多条件更新</span></span><br><span class="line"><span class="keyword">var</span> newData2 = &#123;<span class="attr">$set</span>:&#123;<span class="attr">name</span>:<span class="string">"内容"</span>,<span class="attr">age</span>:<span class="number">2</span>&#125;&#125;;</span><br><span class="line">monModel.update(oldValue,newData,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"update"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.createConnection(<span class="string">'mongodb://127.0.0.1:27017/test'</span>);</span><br><span class="line"><span class="comment">// cosole.log(db);</span></span><br><span class="line"><span class="comment">// 设置数据类型</span></span><br><span class="line"><span class="keyword">var</span> monSchema = <span class="keyword">new</span> mongooose.Schema(&#123;</span><br><span class="line">    name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">default</span>:<span class="string">"name"</span>&#125;,</span><br><span class="line">    age：&#123;<span class="attr">type</span>:<span class="built_in">Number</span>&#125;,</span><br><span class="line">    sex:&#123;<span class="attr">type</span>:<span class="built_in">String</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 选择集合</span></span><br><span class="line"><span class="keyword">var</span> monModel = db.model(<span class="string">'user'</span>,monSchema);</span><br><span class="line"><span class="keyword">var</span> content = &#123;<span class="attr">name</span>:<span class="string">"姓名2"</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> field = &#123;<span class="attr">name</span>:<span class="number">1</span>,<span class="attr">age</span>:<span class="number">1</span>,<span class="attr">sex</span>:<span class="number">1</span>&#125;;</span><br><span class="line">monModel.find(content,field,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;</span><br><span class="line">  db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.createConnection(<span class="string">'mongodb://127.0.0.1:27017/test'</span>);</span><br><span class="line"><span class="comment">// cosole.log(db);</span></span><br><span class="line"><span class="comment">// 设置数据类型</span></span><br><span class="line"><span class="keyword">var</span> monSchema = <span class="keyword">new</span> mongooose.Schema(&#123;</span><br><span class="line">    name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">default</span>:<span class="string">"name"</span>&#125;,</span><br><span class="line">    age：&#123;<span class="attr">type</span>:<span class="built_in">Number</span>&#125;,</span><br><span class="line">    sex:&#123;<span class="attr">type</span>:<span class="built_in">String</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 选择集合</span></span><br><span class="line"><span class="keyword">var</span> monModel = db.model(<span class="string">'user'</span>,monSchema);</span><br><span class="line"><span class="comment">// 原数据字段值</span></span><br><span class="line"><span class="keyword">var</span> oldValue  = &#123;<span class="attr">name</span>:<span class="string">"Nick"</span>&#125;;</span><br><span class="line"><span class="comment">// 单条件更新</span></span><br><span class="line"><span class="keyword">var</span> newData1 = &#123;<span class="attr">$set</span>:&#123;<span class="attr">name</span>:<span class="string">"内容"</span>&#125;&#125;;</span><br><span class="line"><span class="comment">// 多条件更新</span></span><br><span class="line"><span class="keyword">var</span> newData2 = &#123;<span class="attr">$set</span>:&#123;<span class="attr">name</span>:<span class="string">"内容"</span>,<span class="attr">age</span>:<span class="number">2</span>&#125;&#125;;</span><br><span class="line">monModel.update(oldValue,newData,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"update"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/01/06/7招轻松搞定-JavaScript-多行字符串拼接/" class="prev">PREV</a><a href="/2015/01/06/Node.JS-学习笔记-[05]----Express/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 Made with <span>❤</span> by <a href="https://github.com/ifyour/ifyour.github.io">Ifyour</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script><script>new Darkmode({
    bottom: '1rem',
    right: '1rem',
    left: 'unset',
    time: '0.5s',
    mixColor: '#fff',
    backgroundColor: '#fff',
    buttonColorDark: '#100f2c',
    buttonColorLight: '#fff',
    saveInCookies: true,
    label: '🌓',
    autoMatchOsTheme: true
}).showWidget();
</script><script src="/js/algoliasearch.min.js"></script><script src="/js/template-web.min.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/medium-zoom@0/dist/medium-zoom.min.js"></script><script>mediumZoom('article img', {margin: 24});
(function(win, targetElem) {
    if (!targetElem) return;
    win.onscroll = (function() {
        if (isElementInViewport(targetElem)) {
            win.onscroll = null;
            return mediumZoom('.gitment-comment-main img', {margin: 24});
        }
        return arguments.callee;
    })();
    function isElementInViewport(el) {
        var rect = el.getBoundingClientRect();
        var winH = win.innerHeight || document.documentElement.clientHeight;
        return rect.top <= winH && rect.bottom >= winH;
    };
})(this, document.querySelector('#gc_container'));
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-120929321-1",'auto');ga('send','pageview');</script></footer></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>