<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ifyour's Blog"><meta name="msapplication-TileImage" content="/img/webAppIcon-256x256.png"><meta name="msapplication-TileColor" content="#000"><meta property="algolia:search" data-application-id="3XQ5CPDDMK" data-api-key="abe9e26eebcac723f34ade5cf6b97441" data-index-name="prod_blog"><title>浏览器跨域请求数据总结 · Ifyour's Blog</title><meta name="description" content="浏览器跨域请求数据总结 - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="apple-touch-icon" size="256x256" href="/img/webAppIcon-256x256.png"><link rel="apple-touch-icon" size="512x512" href="/img/webAppIcon-512x512.png"><link rel="apple-touch-startup-image" href="/img/apple-launch-750x1334.png"><link rel="preload" href="/css/apollo.css" as="style"><link rel="preload" href="/js/main.js" as="script"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="search"><a href="javascript:;" target="_self" class="close"><svg id="icon-close" viewbox="0 0 16 16" width="24" height="24" fill="#A4A9AC"><path d="M8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 Z M10.44352,10.7233105 L10.4528296,10.7326201 L10.7326201,10.4528296 C11.0310632,10.1543865 11.0314986,9.66985171 10.7335912,9.37194437 L9.36507937,8.0034325 L10.7360526,6.63245928 C11.0344957,6.33401613 11.0349311,5.84948135 10.7370237,5.55157401 L10.448426,5.26297627 C10.1505186,4.96506892 9.66598387,4.96550426 9.36754072,5.26394741 L8.00589385,6.62559428 L6.63738198,5.25708241 C6.33947464,4.95917507 5.85493986,4.95961041 5.55649671,5.25805356 L5.26737991,5.54717036 C4.96893676,5.84561351 4.96850142,6.33014829 5.26640876,6.62805563 L6.62561103,7.9872579 L5.25463781,9.35823112 C4.95619466,9.65667427 4.95575932,10.141209 5.25366666,10.4391164 L5.5422644,10.7277141 C5.84017175,11.0256215 6.32470652,11.0251861 6.62314967,10.726743 L7.99412289,9.35576976 L9.36263476,10.7242816 C9.66054211,11.022189 10.1450769,11.0217536 10.44352,10.7233105 Z"/></svg></a><div class="container"><input id="search-input" autocomplete="off" type="text" placeholder="Type to search" class="search-input"><div class="search-by">Search by<a href="https://www.algolia.com/" target="_blank"> algolia</a></div><div class="search-results"><div id="search-articles" class="search-item"></div></div></div><script id="search-tmp" type="text/html">{{if list.length}}
    <h3>ARTICLES</h3>
    <ul>
        {{each list item}}
        <li>
            <div class="search-item-title">
                <a href="{{item.permalink}}">{{@item.title}}</a>
            </div>
            <div class="search-item-summary" style="-webkit-box-orient: vertical;">
                {{@item.summary}}
            </div>
        </li>
        {{/each}}
    </ul>
{{else if list}}
    <h2>
        Oops! no result,
        Try it on <a target="_blank" style="color: #2c3e50; border-bottom: 2px solid #42b983; font-size: 19px;" href="https://www.google.com/search?q=site%3Aifyour.github.io+{{keywords}}">Google: {{keywords}}</a>~ 😱
    </h2>
{{/if}}</script></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/docs/" target="_self" class="nav-list-link">DOCS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="javascript:;" target="_self" id="search" class="nav-list-link">SEARCH</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">浏览器跨域请求数据总结</h1><div class="post-info">Jan 19, 2016</div><div class="sidebar-toc"><span>Catalog</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#跨域方法"><span class="toc-text">跨域方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#原生-JavaScript-跨域"><span class="toc-text">原生 JavaScript 跨域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jQuery-跨域"><span class="toc-text">jQuery 跨域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iframe-跨域"><span class="toc-text">iframe 跨域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原生-JavaScript-跨域封装"><span class="toc-text">原生 JavaScript 跨域封装</span></a></li></ol></li></ol></div><div class="post-content"><p>首先说下同源，同源策略是浏览器的一种安全策略，所谓同源是指：域名、协议、端口完全相同。而跨域就是不同源！一般 <code>a</code>, <code>img</code>, <code>link</code>, <code>video</code>, <code>audio</code>, 等等能够发出请求的标签都可以实现跨域访问。但是这些标签不能得到返回的东西，所以一般不会用他们来请求资源。<br><a id="more"></a></p>
<h3 id="跨域方法"><a href="#跨域方法" class="headerlink" title="跨域方法"></a>跨域方法</h3><h4 id="原生-JavaScript-跨域"><a href="#原生-JavaScript-跨域" class="headerlink" title="原生 JavaScript 跨域"></a>原生 JavaScript 跨域</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">showuser</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(data);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);<span class="comment">// 处理得到的 data</span></span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://x.cn/showalluser.html?callback=showuser"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="jQuery-跨域"><a href="#jQuery-跨域" class="headerlink" title="jQuery 跨域"></a>jQuery 跨域</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: <span class="string">"post"</span>,</span><br><span class="line">    url: <span class="string">"http://127.0.0.1:8080/showalluser.html"</span>,</span><br><span class="line">    dataType: <span class="string">"jsonp"</span>,</span><br><span class="line">    jsonp: <span class="string">"callback"</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);<span class="comment">// 处理得到的 data</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="iframe-跨域"><a href="#iframe-跨域" class="headerlink" title="iframe 跨域"></a>iframe 跨域</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">URL, callBack</span>) </span>&#123;</span><br><span class="line">    $iframe = $(<span class="string">"&lt;iframe style='display: none;'&gt;&lt;/iframe&gt;"</span>);</span><br><span class="line">    $iframe.prop(<span class="string">"src"</span>, URL);</span><br><span class="line">    $(<span class="string">"body"</span>).append($iframe);</span><br><span class="line"></span><br><span class="line">    $iframe.on(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 转换成 jsonStr</span></span><br><span class="line">        <span class="comment">// contentDocument是 iframe 节点的方法获取contentDocument</span></span><br><span class="line">        <span class="keyword">var</span> ifrDocument = <span class="keyword">this</span>.contentDocument;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> jsonStr = $(ifrDocument).find(<span class="string">"body"</span>).text();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换成 json 对象</span></span><br><span class="line">        <span class="keyword">var</span> jsonObj = <span class="built_in">JSON</span>.parse(jsonStr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把 json 对象传给回调函数</span></span><br><span class="line">        callBack(jsonObj);</span><br><span class="line">        <span class="comment">// 删除当前的 iframe</span></span><br><span class="line">        $(<span class="keyword">this</span>).remove();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原生-JavaScript-跨域封装"><a href="#原生-JavaScript-跨域封装" class="headerlink" title="原生 JavaScript 跨域封装"></a>原生 JavaScript 跨域封装</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 封装数据  跨域url  params fn</span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">crossDomain</span>(<span class="params">url,params,fn</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 1. 处理回调函数</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> cbName = <span class="string">'jsonp'</span>+</span></span><br><span class="line"><span class="javascript">    (<span class="built_in">Math</span>.random() * <span class="built_in">Math</span>.random()).toString().substr(<span class="number">2</span>) +</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 将回调函数挂载到 window 对象上</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>[cbName] = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 拿到并处理数据，交给回调函数</span></span></span><br><span class="line">        fn(data);</span><br><span class="line"><span class="javascript">        <span class="comment">// 拿到数据后remove掉</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//head.removeChild(scriptObj);</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="comment">// 2. 解析url，处理查询字符串 解决这样的需求 ?count=5</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> qstring = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> params)&#123;</span></span><br><span class="line"><span class="javascript">        qstring += key + <span class="string">'='</span> + params[key] + <span class="string">'&amp;'</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    qstring += <span class="string">'callback='</span> + cbName;</span></span><br><span class="line"><span class="javascript">    url += <span class="string">'?'</span> + qstring;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 3. 插入script</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> scriptObj = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line">    scriptObj.src = url;</span><br><span class="line">    head.appendChild(scriptObj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 使用</span></span></span><br><span class="line"><span class="javascript">crossDomain(<span class="string">'http://api.douban.com/v2/movie/in_theaters'</span>,&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解读：注意上面封装的函数会在 head 标签生成下面的内容，并随机产生函数名防止冲突 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jsonp412964552676679031484646377133(data)”&gt;// 挂载在 window 上可以直接执行</span></span></span><br><span class="line"><span class="tag"><span class="string">      /*远程获取的 data 传入 jsonp* 函数内容，交给回调函数fn(data) */</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;/script&gt;</span></span></span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/02/19/JavaScript-中的-this-用法总结/" class="prev">PREV</a><a href="/2016/01/06/7招轻松搞定-JavaScript-多行字符串拼接/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 Made with <span>❤</span> by <a href="https://github.com/ifyour/ifyour.github.io">Ifyour</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script><script>new Darkmode({
    bottom: '1rem',
    right: '1rem',
    left: 'unset',
    time: '0.5s',
    mixColor: '#fff',
    backgroundColor: '#fff',
    buttonColorDark: '#100f2c',
    buttonColorLight: '#fff',
    saveInCookies: true,
    label: '🌓',
    autoMatchOsTheme: true
}).showWidget();
</script><script src="/js/algoliasearch.min.js"></script><script src="/js/template-web.min.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/medium-zoom@0/dist/medium-zoom.min.js"></script><script>mediumZoom('article img', {margin: 24});
(function(win, targetElem) {
    if (!targetElem) return;
    win.onscroll = (function() {
        if (isElementInViewport(targetElem)) {
            win.onscroll = null;
            return mediumZoom('.gitment-comment-main img', {margin: 24});
        }
        return arguments.callee;
    })();
    function isElementInViewport(el) {
        var rect = el.getBoundingClientRect();
        var winH = win.innerHeight || document.documentElement.clientHeight;
        return rect.top <= winH && rect.bottom >= winH;
    };
})(this, document.querySelector('#gc_container'));
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-120929321-1",'auto');ga('send','pageview');</script></footer></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>