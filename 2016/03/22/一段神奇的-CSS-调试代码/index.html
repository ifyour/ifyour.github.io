<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 一段神奇的 CSS 调试代码 · Ifyour's Blog</title><meta name="description" content="一段神奇的 CSS 调试代码 - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/JohnWmm/" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/ifyour/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">一段神奇的 CSS 调试代码</h1><div class="post-info">Mar 22, 2016</div><div class="post-content"><p>现在到处都是 JavaScript，倘若花点时间去深入分析，每次都能学到点新的东西。当我发现些有意思的东西，习惯先收藏起来。等时技（时间＋技术）成熟，再去 Review 他们的代码，看一看它们是如何做到的，览一览大牛们的 “奇技淫巧”。<br><a id="more"></a></p>
<h3 id="代码片段"><a href="#代码片段" class="headerlink" title="代码片段"></a>代码片段</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[].forEach.call($$(<span class="string">"*"</span>),<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</div><div class="line">    a.style.outline=<span class="string">"1px solid #"</span>+(~~(<span class="built_in">Math</span>.random()*(<span class="number">1</span>&lt;&lt;<span class="number">24</span>))).toString(<span class="number">16</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>在浏览器控制台运行此段代码，会给页面里所有的 DOM 元素添加一个 1px 的描边（outline），方便我们在调试 CSS 过程中分析、排查问题。<br><img src="http://ww1.sinaimg.cn/large/6057861cgy1fbzi0vggl6j21kw0vyq8s.jpg" alt=""></p>
<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>这段代码是 Github 上的 140 Bytes 活动中的代码，简单分析下这段 JS 代码，作者使用了不少技巧：</p>
<p>首先是需要选择页面上的所有元素，这里使用了只能在 Console 调试工具中使用的 <code>$$</code> 函数，你可以在 Console 中输入 <code>$$(&#39;a&#39;)</code> 自己试一下。它会返回当前页面的所有 anchor（链接）元素。<code>$$</code> 与 <code>document.querySelectorAll</code> 是等价的，有兴趣可<a href="http://ourjs.com/detail/54ab768a5695544119000007" target="_blank" rel="external">查看</a> $$ 和 $ 选择器的历史。</p>
<p>其次遍历所有元素，这里用的是 <code>[].forEach.call(...)</code>，使用 forEach 替代 for 之类循环能减少不少代码量，而 forEach 是 Array 对象的方法，所以用了个 <code>[]</code> 空数组来代替 <code>Array.prototype</code> 更显简洁，得到所有元素的节点列表（NodeList），但是它并没有实现 Array 的所有接口，因此使用 <code>$$(&quot;*&quot;).forEach</code> 会返回错误，这里使用 <code>call</code> 方法来更改 forEach 内部 <code>this</code> 指向，当然也可以使用 <code>apply。</code></p>
<p>之后就是让元素有一个漂亮的边框，并拥有不同的颜色了。在 CSS 渲染的盒子模型（Box Model）中，<code>outline</code> <strong><em>并不会改变元素及其布局的位置</em></strong>。这里较有意思的是定义不同的颜色的色值：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~~(<span class="built_in">Math</span>.random()*(<span class="number">1</span>&lt;&lt;<span class="number">24</span>))).toString(<span class="number">16</span>)</div></pre></td></tr></table></figure></p>
<p>这里想构造的其实是一个16进制的颜色值，即 <code>000000～ffffff</code>，也就是 <code>parseInt(&#39;0&#39;,16)</code> 到 <code>parseInt(&#39;ffffff&#39;,16)</code> 之间的一个值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">parseInt</span>(<span class="string">'ffffff'</span>,<span class="number">16</span>) == <span class="number">16777215</span> == (<span class="number">2</span>^<span class="number">24</span><span class="number">-1</span>) == (<span class="number">1</span>&lt;&lt;<span class="number">24</span> - <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>而 <code>Math.random()</code>，得到的是一个 0~1 之间的浮点数，<code>(Math.random()*(1&lt;&lt;24)</code>，即得到 0~16777215 之间的浮点数，而色值是需要整数的，所以就需要将浮点数进行 int 转换。这里用到了 <code>~~</code>，可<a href="http://www.jeffjade.com/2015/05/31/2015-05-31-javascript-operational%EF%BC%8Dsymbol/" target="_blank" rel="external">参见</a>理解 JavaScript 非运算符(~/~~ )。当然可以将 <code>~~</code> 视为 <code>parseInt</code> 的简写。并且使用按位或 <code>|</code> 操作符也可以得到相同的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1.234567890</span>;</div><div class="line"><span class="keyword">var</span> b = <span class="number">0.000000001</span>;</div><div class="line">~~a == <span class="number">0</span>|a == <span class="built_in">parseInt</span>(a, <span class="number">10</span>) == <span class="number">1</span></div><div class="line">~~b == <span class="number">0</span>|b == <span class="built_in">parseInt</span>(b, <span class="number">10</span>) == <span class="number">0</span></div></pre></td></tr></table></figure>
<p><code>toString(16)</code> 使用数字类型的 <code>toString</code> 方法进行十进制到16进制的转换。至此我们得到了一个 0 到 16777215之间的随机数，然后使用 <code>toString(16)</code> 转换成16进制，将此值赋予到页面上所有元素节点的 <code>outline</code> 附加属性上。它就是这样工作的。精致巧妙而且非常实用，顶一个！</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/03/23/ProxyChains-NG-搭配-ShadowSocks-实现终端代理/" class="prev">上一篇</a><a href="/2016/02/19/JavaScript-中的-this-用法总结/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ifyour';
var disqus_identifier = '2016/03/22/一段神奇的-CSS-调试代码/';
var disqus_title = '一段神奇的 CSS 调试代码';
var disqus_url = 'http://ifyour.github.io/2016/03/22/一段神奇的-CSS-调试代码/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ifyour.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://ifyour.github.io">Ifyour</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>