<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ifyour's Blog"><meta name="msapplication-TileImage" content="/img/webAppIcon-256x256.png"><meta name="msapplication-TileColor" content="#000"><meta property="algolia:search" data-application-id="3XQ5CPDDMK" data-api-key="abe9e26eebcac723f34ade5cf6b97441" data-index-name="prod_blog"><title>Async/await æŸ¥æ¼è¡¥ç¼º Â· Ifyour's Blog</title><meta name="description" content="Async/await æŸ¥æ¼è¡¥ç¼º - Ifyour"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="apple-touch-icon" size="256x256" href="/img/webAppIcon-256x256.png"><link rel="apple-touch-icon" size="512x512" href="/img/webAppIcon-512x512.png"><link rel="apple-touch-startup-image" href="/img/apple-launch-750x1334.png"><link rel="preload" href="/css/apollo.css" as="style"><link rel="preload" href="/js/main.js" as="script"><link rel="search" type="application/opensearchdescription+xml" href="http://ifyour.github.io/atom.xml" title="Ifyour's Blog"></head><body><div class="search"><a href="javascript:;" target="_self" class="close"><svg id="icon-close" viewbox="0 0 16 16" width="24" height="24" fill="#A4A9AC"><path d="M8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 Z M10.44352,10.7233105 L10.4528296,10.7326201 L10.7326201,10.4528296 C11.0310632,10.1543865 11.0314986,9.66985171 10.7335912,9.37194437 L9.36507937,8.0034325 L10.7360526,6.63245928 C11.0344957,6.33401613 11.0349311,5.84948135 10.7370237,5.55157401 L10.448426,5.26297627 C10.1505186,4.96506892 9.66598387,4.96550426 9.36754072,5.26394741 L8.00589385,6.62559428 L6.63738198,5.25708241 C6.33947464,4.95917507 5.85493986,4.95961041 5.55649671,5.25805356 L5.26737991,5.54717036 C4.96893676,5.84561351 4.96850142,6.33014829 5.26640876,6.62805563 L6.62561103,7.9872579 L5.25463781,9.35823112 C4.95619466,9.65667427 4.95575932,10.141209 5.25366666,10.4391164 L5.5422644,10.7277141 C5.84017175,11.0256215 6.32470652,11.0251861 6.62314967,10.726743 L7.99412289,9.35576976 L9.36263476,10.7242816 C9.66054211,11.022189 10.1450769,11.0217536 10.44352,10.7233105 Z"/></svg></a><div class="container"><input id="search-input" autocomplete="off" type="text" placeholder="Type to search" class="search-input"><div class="search-by">Search by<a href="https://www.algolia.com/" target="_blank"> algolia</a></div><div class="search-results"><div id="search-articles" class="search-item"></div></div></div><script id="search-tmp" type="text/html">{{if list.length}}
    <h3>ARTICLES</h3>
    <ul>
        {{each list item}}
        <li>
            <div class="search-item-title">
                <a href="{{item.permalink}}">{{@item.title}}</a>
            </div>
            <div class="search-item-summary" style="-webkit-box-orient: vertical;">
                {{@item.summary}}
            </div>
        </li>
        {{/each}}
    </ul>
{{else if list}}
    <h2>
        Oops! no result,
        Try it on <a target="_blank" style="color: #2c3e50; border-bottom: 2px solid #42b983; font-size: 19px;" href="https://www.google.com/search?q=site%3Aifyour.github.io+{{keywords}}">Google: {{keywords}}</a>~ ğŸ˜±
    </h2>
{{/if}}</script></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/docs/" target="_self" class="nav-list-link">DOCS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="javascript:;" target="_self" id="search" class="nav-list-link">SEARCH</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Async/await æŸ¥æ¼è¡¥ç¼º</h1><div class="post-info">Jul 22, 2018</div><div class="sidebar-toc"><span>Catalog</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#async-å‡½æ•°"><span class="toc-text">async å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-ä½œç”¨"><span class="toc-text">async ä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#await-ç­‰å¾…"><span class="toc-text">await ç­‰å¾…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-await-é“¾å¼å¤„ç†"><span class="toc-text">async/await é“¾å¼å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-await-æ³¨æ„ç‚¹"><span class="toc-text">async/await æ³¨æ„ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#async-await-ç»“åˆ-try-catch-å†™æ³•"><span class="toc-text">async/await ç»“åˆ try/catch å†™æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»ç»“"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‚è€ƒ"><span class="toc-text">å‚è€ƒ</span></a></li></ol></div><div class="post-content"><p>ä¸Šå‘¨æœ«æˆ‘å¤ä¹ äº† Promise çš„ç”¨æ³•ï¼Œé€šè¿‡ä¸€äº›å®ä¾‹åŠ æ·±äº† Promise çš„ç†è§£ã€‚ä»Šå¤©æ¥çœ‹ä¸‹å¼‚æ­¥ç¼–ç¨‹çš„ç»ˆæè§£å†³æ–¹æ¡ˆ async/awaitã€‚JavaScript ä¸­çš„å¼‚æ­¥æ“ä½œä»æœ€åˆçš„ callback æ¼”è¿›åˆ° Promiseï¼Œå†åˆ° Generatorï¼Œéƒ½æ˜¯é€æ­¥çš„æ”¹è¿›ï¼Œè€Œ async å‡½æ•°çš„å‡ºç°ä»¿ä½›çœ‹åˆ°äº†å¼‚æ­¥æ–¹æ¡ˆçš„ç»ˆç‚¹ï¼Œç”¨åŒæ­¥çš„æ–¹å¼å†™å¼‚æ­¥ä»£ç ã€‚</p>
<a id="more"></a>
<h3 id="async-å‡½æ•°"><a href="#async-å‡½æ•°" class="headerlink" title="async å‡½æ•°"></a>async å‡½æ•°</h3><p>ç®€å•è§£é‡Šï¼šasync å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generator å‡½æ•°å†™æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> promise = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(val);</span><br><span class="line">      resolve(val);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gen = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> p1 = <span class="keyword">yield</span> promise(<span class="string">'1'</span>);</span><br><span class="line">  <span class="keyword">let</span> p2 = <span class="keyword">yield</span> promise(<span class="string">'2'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> genF = gen(); <span class="comment">// Iterator å¯¹è±¡</span></span><br><span class="line">genF.next(); <span class="comment">// =&gt; 1</span></span><br><span class="line">genF.next(); <span class="comment">// =&gt; 2</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤š <code>yield</code> è¡¨è¾¾å¼å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/5a6db41351882573351a8d72" target="_blank" rel="noopener">Generator å‡½æ•°è¯­æ³•è§£æ</a>ã€‚</p>
<p>ä½¿ç”¨ async æ¥æ”¹å†™ä¸Šé¢çš„ <code>gen</code> å‡½æ•° ğŸ‘‡ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> gen = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> p1 = <span class="keyword">await</span> promise(<span class="string">'1'</span>);</span><br><span class="line">  <span class="keyword">let</span> p2 = <span class="keyword">await</span> promise(<span class="string">'2'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">gen();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>async å‡½æ•°æ˜¯åœ¨ Generator å‡½æ•°ä¸Šè¿›è¡Œçš„æ”¹è¿›ï¼Œè¯­æ³•ä¸Š Generator å‡½æ•°çš„æ˜Ÿå·æ¢æˆäº† <code>async</code>ï¼Œ<code>yield</code> æ¢æˆäº† <code>await</code>ã€‚</p>
<p>è€Œ async ä¹Ÿä¸ Generator å‡½æ•° <strong>ä¸åŒ</strong>ï¼š</p>
<ul>
<li><code>async</code> è‡ªå¸¦å†…ç½®æ‰§è¡Œå™¨ï¼ŒGenerator å‡½æ•°éœ€è¦ä¾é æ‰§è¡Œå™¨ï¼Œå¹¶ä¸” <code>async</code> å¯ä»¥å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œåªéœ€è¦ä¸€è¡Œ</li>
<li>ç›¸å¯¹ Generator å‡½æ•°ï¼Œ<code>async</code> å’Œ <code>await</code> è¯­ä¹‰æ›´æ¸…æ¥š</li>
<li>é€‚ç”¨æ€§å¼ºï¼Œ<code>yield</code> ååªèƒ½æ˜¯ Thunk å‡½æ•°å’Œ Promise å¯¹è±¡ï¼Œè€Œ <code>await</code> åå¯ä»¥æ˜¯ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ (æ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å‹ç­‰)</li>
</ul>
<h3 id="async-ä½œç”¨"><a href="#async-ä½œç”¨" class="headerlink" title="async ä½œç”¨"></a>async ä½œç”¨</h3><p>å¯„äºˆ async å‡½æ•°çš„æœŸæœ›æ˜¯å¸Œæœ›å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¼‚æ­¥æ“ä½œé—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ææ¸…æ¥š async å‡½æ•°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwait</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'async await'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = asyncAwait();</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</span></span><br><span class="line"><span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="string">"async await"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡º async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœå‡½æ•°ä¸­ return ä¸€ä¸ªç›´æ¥é‡ï¼Œasync å‡½æ•°ä¼šå°è£…æˆ Promise å¯¹è±¡è¿”å›ï¼Œè€Œå¦‚æœæ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œasync å‡½æ•°ä¼šè¿”å› <code>undefined</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ²¡æœ‰è¿”å›å€¼æ—¶çš„è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</span></span><br><span class="line"><span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="literal">undefined</span>&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ²¡æœ‰ç»“åˆ await æ—¶ï¼Œasync å‡½æ•°ä¼šç«‹å³æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚</p>
<h3 id="await-ç­‰å¾…"><a href="#await-ç­‰å¾…" class="headerlink" title="await ç­‰å¾…"></a>await ç­‰å¾…</h3><p>await æ˜¯ä¸ªè¿ç®—ç¬¦ï¼Œç­‰å¾…çš„ç»“æœæ˜¯ Promise å¯¹è±¡æˆ–å…¶å®ƒå€¼ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'async'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">'await'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwait</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> f1 = <span class="keyword">await</span> func1();</span><br><span class="line">  <span class="keyword">let</span> f2 = <span class="keyword">await</span> func2();</span><br><span class="line">  <span class="built_in">console</span>.log(f1, f2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asyncAwait();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">await</span></span><br></pre></td></tr></table></figure>
<p>await è¡¨è¾¾å¼çš„è¿ç®—å–å†³äºç­‰å¾…çš„ç»“æœï¼Œå¦‚æœå®ƒç­‰åˆ°çš„ä¸æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£è¿ç®—ç»“æœå°±æ˜¯å®ƒç­‰åˆ°çš„ä¸œè¥¿, è€Œå¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå®ƒä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ resolveï¼Œç„¶åå¾—åˆ° resolve çš„å€¼ï¼Œä½œä¸ºè¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚</p>
<div class="tip"><strong>async å‡½æ•°è°ƒç”¨</strong> ä¼šå°è£…åœ¨ Promise ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ await éœ€è¦åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨çš„åŸå› ã€‚</div>

<h3 id="async-await-é“¾å¼å¤„ç†"><a href="#async-await-é“¾å¼å¤„ç†" class="headerlink" title="async/await é“¾å¼å¤„ç†"></a>async/await é“¾å¼å¤„ç†</h3><p>å¯¹äºå¤šä¸ªå¼‚æ­¥æ“ä½œä¸­ï¼ŒPromise çš„ then å¯ä»¥è§£å†³å¤šå±‚å›è°ƒé—®é¢˜ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise è§£å†³å¤šå±‚åµŒå¥—é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(t + <span class="number">200</span>), t);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step1 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step2 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step3 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">'submit'</span>);</span><br><span class="line">  step1(<span class="number">200</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">time2</span> =&gt;</span> step2(time2))</span><br><span class="line">    .then(<span class="function"><span class="params">time3</span> =&gt;</span> step3(time3))</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>ms`</span>);</span><br><span class="line">      <span class="built_in">console</span>.timeEnd(<span class="string">'submit'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">submit();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async å‡½æ•°å®ç°ï¼Œè§£å†³å¤šå±‚åµŒå¥—</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(t + <span class="number">200</span>), t);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step1 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step2 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step3 in <span class="subst">$&#123;t&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">'submit'</span>);</span><br><span class="line">  <span class="keyword">const</span> t1 = <span class="number">200</span>;</span><br><span class="line">  <span class="keyword">const</span> t2 = <span class="keyword">await</span> step1(t1);</span><br><span class="line">  <span class="keyword">const</span> t3 = <span class="keyword">await</span> step2(t2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> step3(t3);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'submit'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">submit();</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1 in 200ms</span><br><span class="line">step2 in 400ms</span><br><span class="line">step3 in 600ms</span><br><span class="line">result is 800</span><br><span class="line">submit: 1209.85107421875ms</span><br></pre></td></tr></table></figure>
<p>è€Œå¦‚æœéœ€æ±‚å˜æ›´ï¼Œæ¯ä¸€æ­¥çš„å‚æ•°éƒ½æ˜¯ä¹‹å‰æ­¥éª¤çš„ç»“æœåï¼Œasync å‡½æ•°å¯ä»¥å†™æˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(t + <span class="number">200</span>), t);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">t1</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step1 in <span class="subst">$&#123;t1&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">t1, t2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step2 in <span class="subst">$&#123;t1&#125;</span>ms,<span class="subst">$&#123;t2&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t1 + t2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">t1, t2, t3</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step3 in <span class="subst">$&#123;t1&#125;</span>ms,<span class="subst">$&#123;t2&#125;</span>ms,<span class="subst">$&#123;t3&#125;</span>ms`</span>);</span><br><span class="line">  <span class="keyword">return</span> ajax(t1 + t2 + t3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">'submit'</span>);</span><br><span class="line">  <span class="keyword">const</span> t1 = <span class="number">200</span>;</span><br><span class="line">  <span class="keyword">const</span> t2 = <span class="keyword">await</span> step1(t1);</span><br><span class="line">  <span class="keyword">const</span> t3 = <span class="keyword">await</span> step2(t1, t2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> step3(t1, t2, t3);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'submit'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">submit();</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ ğŸ‘‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">step1 in 200ms</span><br><span class="line">step2 in 200ms,400ms</span><br><span class="line">step3 in 200ms,400ms,800ms</span><br><span class="line">result is 1600</span><br><span class="line">submit: 2210.47998046875ms</span><br></pre></td></tr></table></figure>
<h3 id="async-await-æ³¨æ„ç‚¹"><a href="#async-await-æ³¨æ„ç‚¹" class="headerlink" title="async/await æ³¨æ„ç‚¹"></a>async/await æ³¨æ„ç‚¹</h3><ol>
<li><code>async</code> ç”¨æ¥å£°æ˜é‡Œé¢åŒ…è£¹çš„å†…å®¹ <strong>èƒ½å¤Ÿä»¥åŒæ­¥çš„æ–¹å¼æ‰§è¡Œ</strong>ï¼Œ<code>await</code> åˆ™æ˜¯è¿›è¡Œæ‰§è¡Œé¡ºåºæ§åˆ¶ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€ä¸ª <code>await</code>ï¼Œé˜»å¡ä»£ç æ‰§è¡Œç­‰å¾… <code>await</code> è¿”å›å€¼ï¼Œç„¶åå†æ‰§è¡Œä¹‹åçš„ <code>await</code></li>
<li><code>await</code> åªèƒ½ç”¨åœ¨ <code>async</code> å‡½æ•°ä¹‹ä¸­ï¼Œç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ä¼šæŠ¥é”™</li>
<li><code>await</code> å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ <code>rejected</code>ï¼Œæ‰€ä»¥æœ€å¥½æŠŠ <code>await</code> å‘½ä»¤æ”¾åœ¨ <code>try...catch</code> ä»£ç å—ä¸­</li>
<li><code>await</code> åé¢çš„è¡¨è¾¾å¼å¦‚æœä¸æ˜¯ Promise å®ä¾‹ï¼Œ<code>await</code> ä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œç„¶åæ‰§è¡Œ <code>async</code> å¤–é¢çš„åŒæ­¥ä»£ç ï¼Œç­‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åå›åˆ° <code>async</code> æ‰§è¡Œè¿™ä¸ªè¡¨è¾¾å¼ä½œä¸º <code>await</code> å†…å®¹ï¼Œè¯¦è§è¿™ä¸ª <a href="https://jsfiddle.net/zd4cbfrv/" target="_blank" rel="noopener">JSFiddle</a></li>
<li><code>await</code> åé¢çš„è¡¨è¾¾å¼æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œ<code>await</code> ä¹Ÿä¼šæš‚åœ <code>async</code> åé¢çš„ä»£ç ï¼Œå…ˆæ‰§è¡Œ <code>async</code> å¤–é¢çš„åŒæ­¥ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ <code>fulfilled</code>ï¼Œç„¶åæŠŠ <code>resolve</code> çš„å‚æ•°ä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœï¼Œè¯¦è§<a href="https://github.com/ifyour/learn-javascript/issues/15" target="_blank" rel="noopener">è¿™é“</a>é¢è¯•é¢˜</li>
</ol>
<h4 id="async-await-ç»“åˆ-try-catch-å†™æ³•"><a href="#async-await-ç»“åˆ-try-catch-å†™æ³•" class="headerlink" title="async/await ç»“åˆ try/catch å†™æ³•"></a>async/await ç»“åˆ try/catch å†™æ³•</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwait</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> promise();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ç§å†™æ³•</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwait</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> promise().catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Async/await æ˜¯ ES7 çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ç›®å‰ç¤¾åŒºé‡Œå…¬è®¤çš„ä¼˜ç§€å¼‚æ­¥è§£å†³æ–¹æ¡ˆï¼Œå½“ä½ æ·±å…¥äº†è§£åŸç†åä¼šå‘ç°ä»¿ä½›çœ‹åˆ°äº†å¼‚æ­¥å›è°ƒéš§é“çš„å°½å¤´äº®å…‰ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="http://es6.ruanyifeng.com/#docs/generator" target="_blank" rel="noopener">Generator å‡½æ•°çš„è¯­æ³• @é˜®ä¸€å³°ã€ŠECMAScript 6 å…¥é—¨ã€‹</a></li>
<li><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener">async å‡½æ•° @é˜®ä¸€å³°ã€ŠECMAScript 6 å…¥é—¨ã€‹</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/09/11/webpack4-å®šåˆ¶å‰ç«¯å¼€å‘ç¯å¢ƒ/" class="prev">PREV</a><a href="/2018/07/15/Promise-æŸ¥æ¼è¡¥ç¼º/" class="next">NEXT</a></div><div id="gc_container"></div><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script><script>(new Gitment({
    id: 'aid' + (new Date('Sun Jul 22 2018 14:44:15 GMT+0800')).getTime()/1000,
    title: 'Async/await æŸ¥æ¼è¡¥ç¼º' + ' Â· è¯„è®º',
    link: decodeURI(location.protocol + '//' + location.hostname + location.pathname),
    repo: 'ifyour.github.io',
    owner: 'ifyour',
    oauth: {
        client_id: '576e98d38d4bd19f8a02',
        client_secret: 'ba3616bf2f20c5da947a1fd5c7ef0edff4ffab99',
    }
})).render('gc_container');</script><div class="copyright"><p>Â© 2015 - 2019 Made with <span>â¤</span> by <a href="https://github.com/ifyour/ifyour.github.io">Ifyour</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script><script>new Darkmode({
    bottom: '1rem',
    right: '1rem',
    left: 'unset',
    time: '0.5s',
    mixColor: '#fff',
    backgroundColor: '#fff',
    buttonColorDark: '#100f2c',
    buttonColorLight: '#fff',
    saveInCookies: true,
    label: 'ğŸŒ“',
    autoMatchOsTheme: true
}).showWidget();
</script><script src="/js/algoliasearch.min.js"></script><script src="/js/template-web.min.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/medium-zoom@0/dist/medium-zoom.min.js"></script><script>mediumZoom('article img', {margin: 24});
(function(win, targetElem) {
    if (!targetElem) return;
    win.onscroll = (function() {
        if (isElementInViewport(targetElem)) {
            win.onscroll = null;
            return mediumZoom('.gitment-comment-main img', {margin: 24});
        }
        return arguments.callee;
    })();
    function isElementInViewport(el) {
        var rect = el.getBoundingClientRect();
        var winH = win.innerHeight || document.documentElement.clientHeight;
        return rect.top <= winH && rect.bottom >= winH;
    };
})(this, document.querySelector('#gc_container'));
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-120929321-1",'auto');ga('send','pageview');</script></footer></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>