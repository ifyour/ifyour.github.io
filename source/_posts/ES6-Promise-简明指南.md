---
title: ES6 Promise ç®€æ˜æŒ‡å—
comments: true
date: 2018-05-29 22:28:41
tags:
from: https://codeburst.io/a-simple-guide-to-es6-promises-d71bacd2e13a
---

Promise æ˜¯ JavaScript ES6 ä¸­æœ€ä»¤äººå…´å¥‹çš„æ–°å¢åŠŸèƒ½ä¹‹ä¸€. ES5 ä¸­ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†å¼‚æ­¥æ“ä½œ. è¿‡åº¦ä½¿ç”¨å›è°ƒåˆ™ä¼šäº§ç”Ÿå›è°ƒåœ°ç‹±å’Œå¤šçº§åµŒå¥—ç¼©å¸¦æ¥çš„é—®é¢˜. Promise é€šè¿‡å°†å¼‚æ­¥ä»£ç è½¬åŒ–æˆåŒæ­¥æ‰§è¡Œçš„æ–¹å¼, å¤§å¤§ç®€åŒ–äº†å¼‚æ­¥ç¼–ç¨‹æ–¹å¼.

<!-- more -->

è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Promise ä»¥åŠåœ¨å¼€å‘ä¸­çš„å®è·µ.

### ä»€ä¹ˆæ˜¯ Promise

ç®€å•æ¥è¯´ **Promise** å°±æ˜¯ä¸€ä¸ªå­˜æ”¾ç€æœªæ¥æ‰ä¼šæœ‰è®¡ç®—ç»“æœçš„å ä½ç¬¦. ç¨å¾®æƒ³æƒ³, ä½ ä¼šå‘ç°, è¿™å’Œæˆ‘ä»¬å¹³å¸¸åœ¨è°ˆè¯è¿‡ç¨‹ä¸­è¯´çš„ **æ‰¿è¯º** å¾ˆåƒ. ä¸¾ä¸ªä¾‹å­: ä½ å‡†å¤‡å»å°åº¦æ—…è¡Œ, ä½ è®¢äº†ä¸€å¼ å»å°åº¦çš„æœºç¥¨. è¿™ä¸ªæœºç¥¨ä¸Šå†™ç€å¤šå°‘å·, åº§ä½å·æ˜¯å¤šå°‘. è¿™ä¸ªåœºæ™¯ä¸‹, æœºç¥¨å°±æ˜¯èˆªç©ºå…¬å¸ç»™ä½ è®¸ä¸‹çš„æ‰¿è¯º: åœ¨ä½ å‡†å¤‡å‡ºå‘é‚£å¤©ç»™ä½ é¢„ç•™äº†ä¸€ä¸ªå¤´ç­‰èˆ±! ğŸ˜

è¿˜æœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­, ä½ æ‰¿è¯ºä½ çš„æœ‹å‹, å½“ä½ è¯»å®Œã€Šè®¡ç®—æœºç¼–ç¨‹è‰ºæœ¯ã€‹è¿™æœ¬ä¹¦å, ä½ å°±æŠŠè¿™æœ¬ä¹¦è¿˜å›å». åœ¨è¿™é‡Œ, ä½ æ‰€è¯´çš„è¯å°±å¥½æ¯”æ˜¯ä¸€ä¸ªå ä½ç¬¦, éœ€è¦è¿”å›çš„å€¼å°±æ˜¯è¿™æœ¬ä¹¦.

ä½ è¿˜å¯ä»¥æƒ³åˆ°å…¶ä»–ä¸€äº›ç±»ä¼¼æ‰¿è¯ºçš„ä¾‹å­, æ¯”å¦‚åœ¨åŒ»ç”ŸåŠå…¬å®¤ç­‰ç€ã€åœ¨é¤é¦†ç‚¹é¤ã€åœ¨å›¾ä¹¦é¦†å†™ä¹¦ç­‰ç­‰. éƒ½æ¶‰åŠæŸç§å½¢å¼çš„æ‰¿è¯º.

### ç”Ÿæˆä¸€ä¸ª Promise

å½“æŸé¡¹ä»»åŠ¡çš„å®Œæˆæ—¶é—´ä¸ç¡®å®šæˆ–å¤ªé•¿æ—¶, å°±å¯ä»¥ä½¿ç”¨ Promise. ä¾‹å¦‚, ç½‘ç»œè¯·æ±‚å¯èƒ½éœ€è¦ 10ms åˆ° 200 ms (æˆ–æ›´é•¿) çš„æ—¶é—´, å…·ä½“å–å†³äºç½‘é€Ÿ. æˆ‘ä»¬ä¸æƒ³åœ¨è·å–æ•°æ®æ—¶ç­‰å¾…. 200 æ¯«ç§’å¯¹ä½ æ¥è¯´å¯èƒ½ä¸å¤ªé‡è¦, ä½†å¯¹äºä¸€å°ç”µè„‘æ¥è¯´, è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´.`Promise` å°±æ˜¯è¦è®©è¿™ç§å¼‚æ­¥å˜å¾—ç®€å•ã€è½»æ¾.

ä½¿ç”¨ Promise æ„é€ å‡½æ•°, æ¥å®ä¾‹åŒ–ä¸€ä¸ª myPromise å®ä¾‹, åƒè¿™æ ·:

```js
const myPromise = new Promise((resolve, reject) => {
  if (Math.random() * 100 <= 90) {
    resolve('Hello, Promises!');
  }
  reject(new Error('In 10% of the cases, I fail. Miserably.'));
});
```

æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¥æ”¶ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°. `new Promise()` è¢«ç§°ä¸ºæ‰§è¡Œå™¨å‡½æ•°, å®ƒæè¿°äº†è¦å®Œæˆçš„è®¡ç®—. å®ƒçš„è¿™ä¸¤ä¸ªå‚æ•°é€šå¸¸è¢«å«åš `resolve` å’Œ `reject`, å¯ä»¥ç†è§£ä¸º **æ‰§è¡Œ** å’Œ **æ‹’ç»**, å®ƒä»¬ç”¨æ¥æ ‡è®°æ‰§è¡Œå™¨å‡½æ•°æœ€ç»ˆçš„è®¡ç®—ç»“æœ. `resolve` å’Œ `reject` æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°, å®ƒç”¨æ¥è¿”å›ä¸€ä¸ªå€¼ç»™æˆ‘ä»¬çš„ Promise å®ä¾‹.

å½“è¿ç®—ç»“æœæˆåŠŸæ—¶, æˆ–è€…æœªæ¥ç€è¿™ä¸ªå€¼å‡†å¤‡å°±ç»ªæ—¶, æˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ª `resolve` å‡½æ•°æ¥è¿”å›ä¸€ä¸ªå€¼, æˆ‘ä»¬å°±è¯´: æˆ‘è·µè¡Œäº†å½“åˆè®¸ä¸‹çš„è¿™ä¸ªæ‰¿è¯º.

åŒç†, å½“è®¡ç®—ç»“æœå¤±è´¥æ—¶, æˆ–è€…è®¡ç®—è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯, æˆ‘ä»¬å°±ä½¿ç”¨ `reject` å‡½æ•°, æˆ‘ä»¬å°±è¯´: æˆ‘æ‹’ç»å±¥è¡Œè¿™ä¸ªæ‰¿è¯º. `reject` å‡½æ•°å¯ä»¥æ¥æ”¶ä»»ä½•å€¼æ¥ä½œä¸ºå‚æ•°, ä½†æ˜¯æ¯”è¾ƒæ¨èçš„æ˜¯æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ª `Error` å¯¹è±¡, å³: æŠ›å‡ºä¸€ä¸ªé”™è¯¯, ç”¨æ¥å¸®åŠ©æˆ‘ä»¬è°ƒè¯•ä»£ç , è¿™æ ·å°±å¯ä»¥æ ¹æ®å…·ä½“çš„æŠ›å‡ºé”™è¯¯ä¿¡æ¯å»è§£å†³é—®é¢˜å•¦.

åœ¨ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­, `Math.random()` ç”¨æ¥ç”Ÿæˆä¸€ä¸ªéšæœºæ•°, åœ¨ 90% çš„æƒ…å†µä¸‹, è¿™ä¸ª Promise éƒ½åº”è¯¥è¢«æ‰§è¡Œ (å‡è®¾ç­‰æ¦‚ç‡åˆ†å¸ƒ), å‰©ä½™çš„æƒ…å†µä¸‹éƒ½æ˜¯æ‹’ç»æ‰§è¡Œçš„.

### å¦‚ä½•ä½¿ç”¨ Promises

åœ¨ä¸Šé¢çš„ä»£ç ä¾‹å­ä¸­, æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ª Promise å®ä¾‹ `myPromise`, é‚£ä¹ˆå¦‚ä½•é€šè¿‡ `resolve` å’Œ `reject` å‡½æ•°è®¿é—®è®¡ç®—å®Œæˆåçš„å€¼å‘¢? æ‰€æœ‰çš„ `Promise` å®ä¾‹éƒ½æœ‰ä¸€ä¸ª`.then()` æ–¹æ³•, æˆ‘ä»¬æ¥ç§ç§:

```js
const myPromise = new Promise((resolve, reject) => {
  if (Math.random() * 100 < 90) {
    console.log('resolving the promise ...');
    resolve('Hello, Promises!');
  }
  reject(new Error('In 10% of the cases, I fail. Miserably.'));
});

// Two functions
const onResolved = resolvedValue => console.log(resolvedValue);
const onRejected = error => console.log(error);

myPromise.then(onResolved, onRejected);

// Same as above, written concisely
myPromise.then(
  resolvedValue => {
    console.log(resolvedValue);
  },
  error => {
    console.log(error);
  }
);

// Output (in 90% of the cases)

// resolving the promise ...
// Hello, Promises!
// Hello, Promises!
```

`.then()` æ–¹æ³•æ¥æ”¶ 2 ä¸ªå›è°ƒå‡½æ•°, ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯å½“æˆ‘ä»¬çš„ Promise å®ä¾‹è¢«æ‰§è¡Œ (resolve) æ—¶è°ƒç”¨, ç¬¬äºŒä¸ªåˆ™æ˜¯è¢«æ‹’ç» (reject) æ—¶è°ƒç”¨. åœ¨ä¸Šé¢çš„ä»£ç ä¸­, æˆ‘ä»¬ä½¿ç”¨ `onResolved` å’Œ `onRejected` å®šä¹‰äº†è¿™ä¸¤ä¸ªå‡½æ•°, ç„¶åæŠŠå®ƒæ”¾åˆ° `.then` å‡½æ•°é‡Œ, å½“ç„¶, ä½ ä¹Ÿå¯ä»¥æŒ‰ç…§å¸¸è§„å†™æ³•, ç›´æ¥åœ¨ `.then` å‡½æ•°é‡Œå†™ä¸¤ä¸ªå‡½æ•°, éƒ½æ˜¯ä¸€æ ·çš„.

åœ¨è¿™ä¸ªä¾‹å­ä¸­, æœ‰å‡ ç‚¹éå¸¸é‡è¦, æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹:

* ä¸€ä¸ª `promise` åªèƒ½æ˜¯æˆåŠŸæˆ–è€…å¤±è´¥çŠ¶æ€ä¸­çš„ä¸€ä¸ª. å®ƒä¸èƒ½æˆåŠŸæˆ–è€…å¤±è´¥å¤šæ¬¡. ä¹Ÿä¸èƒ½ä»æˆåŠŸçŠ¶æ€åˆ‡æ¢åˆ°å¤±è´¥çŠ¶æ€, å¤±è´¥åä¹‹äº¦ç„¶.
* ä½ å¯ä»¥åœ¨æˆåŠŸæˆ–è€…å¤±è´¥çŠ¶æ€å, å»å®šä¹‰è¿™æ ·ä¸€ä¸ªå›è°ƒå‡½æ•°. å½“ä»–ä»¬ `resolve` æˆ–è€… `reject` ä»ç„¶èƒ½æ­£ç¡®è°ƒç”¨.

è¿™å°±è¯´æ˜, `Promise` æœ€ç»ˆåªæœ‰ä¸€ä¸ªçŠ¶æ€, å³ä½¿ä½ å¤šæ¬¡ä½¿ç”¨ `.then` å¤„ç†å‡½æ•°, è¿™ä¸ªçŠ¶æ€ä¸èƒ½æ›´æ”¹ (è®¡ç®—ç»“æœä¹Ÿä¸ä¼šé‡å¤æ‰§è¡Œ).

ä¸ºäº†éªŒè¯è¿™ç‚¹, ä½ å¯ä»¥çœ‹åˆ°åœ¨ç¬¬ 3 è¡Œä»£ç ä¸­, `console.log` è¯­å¥, å½“ä½ å¤šæ¬¡ä½¿ç”¨ `.then` å¤„ç†ç¨‹åºè¿è¡Œä¸Šè¿°ä»£ç æ—¶, `console.log` çš„è¯­å¥åªä¼šè¢«æ‰“å°ä¸€æ¬¡. è¿™å°±è¯´æ˜äº† Promise ä¼šç¼“å­˜è®¡ç®—ç»“æœçš„, å½“æœ‰ä¸€äº›ç›¸åŒçš„ç»“æœæ—¶, ç¼“å­˜ç»“æœä¼šè¢«è¿”å›.

å¦ä¸€ä¸ªé‡è¦çš„è¦æ³¨æ„çš„æ˜¯, Promise æ˜¯ [åŠæ—©æ±‚å€¼ (evaluated eagerly)](https://zh.wikipedia.org/wiki/%E5%8F%8A%E6%97%A9%E6%B1%82%E5%80%BC) çš„: åªè¦å£°æ˜å¹¶å°†å…¶èµ‹å€¼åˆ°å˜é‡ä¸Š, å®ƒå·²ç»å¼€å§‹åœ¨å†…å­˜ä¸­æ‰§è¡Œäº†. æ²¡æœ‰ `.start` æˆ–`.begin` æ–¹æ³•. å°±åƒå®ƒåœ¨å‰é¢çš„ä¾‹å­ä¸­å¼€å§‹çš„é‚£æ ·.

ä¸ºäº†ç¡®ä¿ Promise èƒ½è¢«å»¶è¿Ÿè°ƒç”¨, æˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦åœ¨å®ƒçš„å¤–å±‚åŒ…è£¹ä¸€ä¸ªå‡½æ•°, ç¨åçš„ä¾‹å­ä¸­æˆ‘ä»¬ä¼šè§£é‡Šè¿™ä¸ª.

### æ•è· Promise

åˆ°ç›®å‰ä¸ºæ­¢, æˆ‘ä»¬å·²ç»çœ‹åˆ°äº† `resolve` çš„åœºæ™¯, é‚£ä¹ˆå½“æ‰§è¡Œå‡½æ•°ä¸­å‡ºç°ä¸€ä¸ªé”™è¯¯æ—¶, ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? åœ¨ `.then()` å‡½æ•°ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°, å°±æ˜¯ä¸Šé¢ä¾‹å­ä¸­çš„ `onRejected` ä¼šè¢«æ‰§è¡Œ, æ¥çœ‹ä¸€ä¸ªä¾‹å­:

```js
const myPromise = new Promise((resolve, reject) => {
  if (Math.random() * 100 < 90) {
    reject(new Error('The promise was rejected by using reject function.'));
  }
  throw new Error('The promise was rejected by throwing an error');
});

myPromise.then(
  () => console.log('resolved'),
  error => console.log(error.message)
);

// Output (in 90% of cases)

// The promise was rejected by using reject function.
```

å’Œç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·çš„, ä½†æ˜¯ç°åœ¨ 90% çš„æƒ…å†µæ˜¯è¢« `reject` çš„, å¦å¤– 10% çš„æƒ…å†µåˆ™æ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯è¯­å¥.

åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº† `onResolved` å’Œ `onRejected` æ–¹æ³•, `onRejected` æ–¹æ³•å°†åœ¨é”™è¯¯å‘ç”Ÿæ—¶è¢«è°ƒç”¨, å¯ä»¥çœ‹åˆ° `reject` å‡½æ•°çš„å‚æ•°å¯ä»¥ç›´æ¥æ˜¯é”™è¯¯æç¤º, æ²¡å¿…è¦å¿…é¡» `new Error`, ä¸¤ä¸ªå†™æ³•éƒ½ä¸€æ ·.

å¥å£®çš„ç¨‹åºä»£ç ç¦»ä¸å¼€é”™è¯¯å¤„ç†, `.then` æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ç»™äº†æˆ‘ä»¬è¿™æ ·ä¸€ä¸ªæ·å¾„. å½“éœ€è¦å¤„ç†ä¸€ä¸ªé”™è¯¯æ—¶, å¯ä»¥ç”¨ `.catch(onRejected)` æ¥ä»£æ›¿ `.then(null, () => {...})`, `catch` æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•° `onRejected`, å› æ­¤, ä¸Šé¢çš„ä»£ç , å¯ä»¥ä½¿ç”¨ `catch` æ¥ç®€åŒ–å†™æ³•:

```js
myPromise.catch(error => console.log(error.message));
```

è®°ä½: `.catch` æ–¹æ³•ä»…ä»…æ˜¯ `.then(undefined, onRejected)` çš„è¯­æ³•ç³–è€Œå·².

### é“¾å¼ Promise

`.then()` å’Œ `.catch()` æ–¹æ³•æ°¸è¿œä¼šè¿”å›ä¸€ä¸ª Promise å®ä¾‹, æ‰€ä»¥ä½ å¯ä»¥é“¾å¼ä½¿ç”¨å¤šä¸ª `.then` ä¸€èµ·æ¥è°ƒç”¨. è®©æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ç†è§£å®ƒ.

é¦–å…ˆ, æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°, æ¥å»¶è¿Ÿè¿”å›ä¸€ä¸ª Promise å®ä¾‹. è¿™ä¸ªè¿”å›çš„ Promise å°†åœ¨ç¨åçš„æ—¶é—´å†… `resolve`. è¿™é‡Œæ˜¯å®ç°æ–¹æ³•:

```js
const delay = ms => new Promise(resolve => setTimeout(resolve, ms));
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æ¥åŒ…è£¹æˆ‘ä»¬çš„ Promise å®ä¾‹, æ‰€ä»¥å®ƒå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œ. è¿™ä¸ª `delay` å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ—¶é—´æ¥ä½œä¸ºå‚æ•°. è¿™ä¸ªæ‰§è¡Œå‡½æ•°å°†æ¥æ”¶ `ms` ä½œä¸ºä»–çš„å‚æ•°, å®ƒè¿˜åŒ…å«ä¸€ä¸ª `setTimeout` , å®ƒåœ¨ `ms` æ¯«ç§’åè°ƒç”¨ `resolve` å‡½æ•°, ä»è€Œæ­£ç¡®æ‰§è¡Œ. çœ‹è¿™ä¸ªä¾‹å­:

```js
delay(5000).then(() => console.log('Resolved after 5 seconds'));
```

`.then` ä¸­çš„å›è°ƒè¯­å¥å°†åœ¨ `delay(5000)` åæ‰§è¡Œ. å½“ä½ æ‰§è¡Œä¸Šé¢çš„ä»£ç  5 ç§’å, ä½ å°±å¯ä»¥åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°è¾“å‡ºç»“æœäº†.

è¿™é‡Œ, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ª `.then()` æ–¹æ³•æ¥é“¾å¼è°ƒç”¨:

```js
const delay = ms => new Promise(resolve => setTimeout(resolve, ms));

delay(2000)
  .then(() => {
    console.log('Resolved after 2 seconds');
    return delay(1500);
  })
  .then(() => {
    console.log('Resolved after 1.5 seconds');
    return delay(3000);
  })
  .then(() => {
    console.log('Resolved after 3 seconds');
    throw new Error();
  })
  .catch(() => {
    console.log('Caught an error.');
  })
  .then(() => {
    console.log('Done.');
  });

// Resolved after 2 seconds
// Resolved after 1.5 seconds
// Resolved after 3 seconds
// Caught an error.
// Done.
```

ä»ç¬¬ 3 è¡Œå¼€å§‹, å®ƒçš„æ‰§è¡Œæ­¥éª¤æ˜¯è¿™æ ·çš„:

* `delay(2000)` å‡½æ•°æ‰§è¡Œ, å®ƒè¿”å›ä¸€ä¸ªç¨å 2 ç§’å³å°†æ‰§è¡Œçš„ Promise å®ä¾‹.
* ç¬¬ 1 ä¸ª `.then()` æ‰§è¡Œ, å®ƒè¾“å‡ºè¯­å¥ `Resolved after 2 seconds`, ç„¶åå®ƒæ‰§è¡Œ `delay(1500)` åˆè¿”å›ä¸€ä¸ª Promise å®ä¾‹, å¦‚æœä¸€ä¸ª `.then()` è¿”å›äº†ä¸€ä¸ª Promise å®ä¾‹, é‚£ä¹ˆå®ƒçš„ `resolve` å°†è¢«è½¬å‘ç»™ä¸‹ä¸€ä¸ª `.then` æ–¹æ³•è°ƒç”¨, æŠ€æœ¯ä¸Šå«: æ²‰é™ (settlement).
* åªè¦åƒè¿™æ ·ç»§ç»­ä¸²è”ä¸‹å», å®ƒä¼šç»§ç»­æ‰§è¡Œ.

æ³¨æ„åœ¨ç¬¬ä¸‰ä¸ª `.then()` æ–¹æ³•æ—¶, æˆ‘ä»¬åœ¨ `.then` ä¸­æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯. è¿™æ„å‘³ç€å½“å‰çš„ Promise è¢«æ‹’ç». ç„¶åå®ƒä¼šåœ¨ä¸‹ä¸€ä¸ª `.catch` è¯­å¥ä¸­è¢«æ•è·, `Caught an error` å°†ä¼šè¢«è¾“å‡º. ç„¶è€Œä¸€ä¸ª `.catch` è¯­å¥å®ƒè‡ªå·±æ°¸è¿œæ˜¯è¢« `resolve` çš„, æ‰€ä»¥ä¸éœ€è¦åœ¨è¯­å¥é‡Œå†å†™ `reject` (é™¤éä½ æ•…æ„æŠ›å‡ºä¸€ä¸ªé”™è¯¯), è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ `.catch` è¯­å¥åè¿˜å¯ä»¥ç»§ç»­å†™ `.then` çš„åŸå› .

æ¯”è¾ƒæ¨èçš„åšæ³•æ˜¯åœ¨ `.then` æ–¹æ³•åæ‰§è¡Œ `.catch` è€Œä¸æ˜¯ä½¿ç”¨ `onResolved` å’Œ `onRejected`, æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹:

```js
const promiseThatResolves = () =>
  new Promise((resolve, reject) => {
    resolve();
  });

// Leads to UnhandledPromiseRejection
promiseThatResolves().then(
  () => {
    throw new Error();
  },
  err => console.log(err)
);

// Proper error handling
promiseThatResolves()
  .then(() => {
    throw new Error();
  })
  .catch(err => console.log(err));
```

æˆ‘ä»¬åˆ›é€ ä¸€ä¸ªæ°¸è¿œèƒ½è¢« `resolve` çš„ Promise å®ä¾‹, å½“ä½ æ‰§è¡Œ `.then` æ—¶, å¯ä»¥å¸¦ä¸¤ä¸ªå›è°ƒå‡½æ•°: `onResolved` å’Œ `onRejected`, ç¬¬ä¸€ç§å†™æ³•, åœ¨ `then` ç§æ”¾å…¥ä¸¤ä¸ªå›è°ƒå‡½æ•°, ä½†æ˜¯: å¦‚æœåœ¨ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ç»§ç»­æŠ›å‡ºé”™è¯¯, é‚£ä¹ˆè¿™ä¸ªé”™è¯¯æ˜¯ä¸èƒ½è¢«æ•è·çš„. ğŸ˜…

ç¬¬äºŒç§å†™æ³•, åœ¨ `.then` è¯­å¥çš„åé¢ä½¿ç”¨ `.catch` æ•è·, ä¸å…‰èƒ½æ•è·åˆ°æ‰§è¡Œå‡½æ•° `promiseThatResolves` çš„é”™è¯¯, è€Œä¸”åœ¨ `.then()` ä¸­çš„é”™è¯¯ä¹Ÿæ˜¯èƒ½è¢«æ•è·åˆ°. çŸ¥é“è¿™æ ·å†™çš„å¥½å¤„äº†å§!ğŸ˜

### æ€»ç»“

ä½ å¯ä»¥æ‰§è¡Œä¸Šé¢çš„æ‰€æœ‰ä»£ç ç‰‡æ®µæ¥æ›´æ·±å…¥çš„å­¦ä¹ . ä¸€ç§æ¯”è¾ƒå¥½çš„å®è·µå°±æ˜¯, æŠŠæ‰€æœ‰åŸºäºå›è°ƒçš„å‡½æ•°éƒ½ç”¨ Promise æ¥é‡æ–°å®ç°. å¦‚æœä½ å†™ Node.js çš„è¯, ä½ ä¼šå‘ç° `fs` è¿˜æœ‰å…¶ä»–æ¨¡å—éƒ½æ˜¯åŸºäºå›è°ƒå‡½æ•°æ¥å®ç°çš„. æ‰€ä»¥ä¼šå­˜åœ¨ä¸€äº›å·¥å…·åº“, å®ƒä»¬æŠŠæ‰€æœ‰åŸºäºå›è°ƒçš„å®ç°æ–¹å¼ä½¿ç”¨ Promise æ¥å®ç°äº†. æ¯”å¦‚ Node.js çš„ [util.promisify](https://nodejs.org/api/util.html#util_util_promisify_original) å’Œ [pify](https://github.com/sindresorhus/pify). å¦‚æœä½ åœ¨å­¦ä¹ çš„è¯, é‚£ä¹ˆå°½å¯èƒ½çš„å°è¯•è‡ªå·±å»å®ç°. æˆ–è€…è¯´å»è¯»è¿™äº› Promise å®ç°åº“çš„æºä»£ç . ç„¶åä½ å°±å¯ä»¥æŠŠè¿™äº›æœ€ä½³å®è·µç”¨äºä½ çš„äº§å“ä¸­å•¦!

è¿˜æœ‰ä¸€äº›å…³äº Promise çš„ä¸œè¥¿æ²¡æœ‰å®Œå…¨è®²åˆ°, æ¯”å¦‚ `Promise.all` å’Œ `Promise.race` æ–¹æ³•, å¤„ç† Promise ä¸­çš„é”™è¯¯, ä»¥åŠä¸€äº›å¸¸è§çš„åæ¨¡å¼å’Œç»†èŠ‚ç­‰. ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„é“¾æ¥æ¥å­¦ä¹ æ›´å¤šå…³äº Promise çš„çŸ¥è¯†.

### å‚è€ƒ

* [ECMA Promise Specification](http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects)
* [Mozilla Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)
* [Googleâ€™s Developerâ€™s Guide on Promises written by Jake Archibald](https://developers.google.com/web/fundamentals/primers/promises#promise-api-reference)
* [Exploring JSâ€™s Chapter on Promises](http://exploringjs.com/es6/ch_promises.html#sec_first-example-promises)
* [Introduction to Promises](http://jamesknelson.com/grokking-es6-promises-the-four-functions-you-need-to-avoid-callback-hell/)
